{"metadata":{"title":"Descarga automatizada con Wget","layout":"lesson","date":"2012-06-27T00:00:00.000Z","translation_date":"2018-11-29T00:00:00.000Z","authors":["Ian Milligan"],"reviewers":["Aurélien Berra"],"editors":["Adam Crymble"],"translator":["Víctor Gayol"],"translation-editor":["Jennifer Isasi"],"translation-reviewer":["Jennifer Isasi","Joshua Ortiz-Baco"],"original":"automated-downloading-with-wget","exclude_from_check":["review-ticket"],"difficulty":1,"activity":"acquiring","topics":["web-scraping"],"abstract":"Wget es un programa útil que se ejecuta a través de la línea de comandos de tu computadora. Sirve para recuperar material en línea.","avatar_alt":"Grabado de dos mineros dentro de una mina empujando carretillas hasta un ascensor.","doi":"10.46430/phes0035"},"html_body":"<p>{% include toc.html %}</p>\n<h2 id=\"nota-del-editor\">Nota del editor</h2>\n<p>Esta lección requiere que uses la línea de comandos. Si no tienes experiencia previa en el uso de la línea de comandos, será útil estudiar la lección  <a href=\"/es/lecciones/introduccion-a-bash\">Introducción a la línea de comandos en Bash</a>, en <em>The Programming Historian</em> en español.</p>\n<h2 id=\"objetivos-de-la-lección\">Objetivos de la lección</h2>\n<p>Esta lección está diseñada para usuarias/os intermedias/os, aunque pueden seguirla principiantes.</p>\n<p>Wget es un programa útil, que se ejecuta a través de la línea de comandos de tu computadora y  sirve para recuperar material en línea.</p>\n<p>{% include figure.html filename=&quot;Terminal-on-mac2.png&quot; caption=&quot;Intérprete de línea de comandos, Terminal, en Mac&quot; %}</p>\n<p>Puede ser de utilidad en las siguientes situaciones:</p>\n<ul>\n<li>Recuperar o duplicar (crear una copia exacta) de un sitio web completo. Este sitio web puede contener documentos históricos, o simplemente puede ser tu propio sitio web personal del que deseas hacer una copia de seguridad. Un comando u orden puede descargar todo el sitio en tu computadora.</li>\n<li>Descargar archivos específicos de la jerarquía de un sitio web (cierta parte del sitio web como, por ejemplo, cada página que se encuentre dentro del directorio <code>/papeles/</code> del sitio).</li>\n</ul>\n<p>En esta lección trabajaremos con tres ejemplos rápidos de cómo puedes usar wget en tu trabajo. Al final de la lección podrás descargar rápidamente grandes cantidades de información de Internet de manera automatizada. Si encuentras un repositorio de información histórica en línea, en lugar de hacer clic con el botón derecho en cada archivo y guardarlo para construir tu conjunto de datos, tendrás las habilidades para elaborar un solo comando que descargue todo.</p>\n<p>Primero, algunas precauciones. Debes tener cuidado de cómo usas wget. Si consultas el manual en caso de duda y repasas la lección aquí, está bien. Siempre debes generar un retraso en tus comandos para no sobrecargar los servidores y también debes poner un límite a la velocidad de descarga. Todo esto es parte del ser un buen ciudadano de Internet. Podemos pensar en la analogía de utilizar una toma de agua con prudencia en vez de abrir todas las llaves al mismo tiempo (no es bueno para ti ni para la compañía de agua).</p>\n<p>Trata de específicar de la mejor manera posible la formulación de tu descarga. Hay por ahí un chiste que sugiere que puedes descargar accidentalmente ¡todo Internet con wget! Es un poco exagerado, ¡pero no está demasiado lejos!</p>\n<p>Comencemos.</p>\n<h2 id=\"primer-paso-la-instalación\">Primer paso: la instalación</h2>\n<h3 id=\"instrucciones-para-linux\">Instrucciones para Linux</h3>\n<p>Si usas Linux ya debes tener instalado wget. Compruébalo abriendo tu línea de comandos. Escribe <code>wget</code> y presiona enter. Si tienes instalado wget el sistema responderá:</p>\n<pre><code>-&gt; Missing URL.\n</code></pre>\n<p>si no está instalado verás:</p>\n<pre><code>-&gt; command not found.\n</code></pre>\n<p>Si usas OS X o Windows tienes que descargar el programa. Usuarias/os de Linux sin wget deben seguir las instrucciones para OS X a continuación.</p>\n<h3 id=\"instrucciones-para-os-x\">Instrucciones para OS X</h3>\n<h4 id=\"opción-uno-en-os-x-el-método-preferido\">Opción uno en OS X: el método preferido</h4>\n<p>En OS X hay dos formas de obtener wget e instalarlo. Lo más fácil es instalar un administrador de paquetes y usarlo para instalar wget automáticamente. Hay un segundo método, que se discute más adelante, que involucra compilarlo.</p>\n<p>Sin embargo, para un correcto funcionamiento de ambos métodos se requiere que instales las &#39;Herramientas para línea de comandos&#39; de Apple. Esto implica descargar XCode. Si tienes el &#39;App Store&#39;, puedes <a href=\"https://itunes.apple.com/us/app/xcode/id497799835?mt=12\">descargar XCode a través de este enlace</a>. Si no, las siguientes instrucciones funcionarán.</p>\n<p>Para descargar XCode, ve al <a href=\"https://developer.apple.com/xcode/\">sitio web de desarrolladores de Apple</a>, regístrate como desarrollador y luego en la sección <a href=\"https://developer.apple.com/xcode/\">descargas para desarrolladores de Apple</a> necesitarás encontrar la versión correcta. Si estás en la versión más reciente, Lion a partir de julio de 2012,[^1] puedes utilizar el enlace principal. De lo contrario, deberás hacer clic en el enlace: &quot;¿Está buscando herramientas de desarrollador adicionales? <a href=\"https://developer.apple.com/downloads/\">Ver descargas</a>&quot;.</p>\n<p>Después de iniciar sesión con tus credenciales de desarrollador gratuitas verás una larga lista. Escribe &quot;xcode&quot; en la barra de búsqueda y encuentra la versión que sea compatible con la versión de tu sistema operativo. Encontrar la versión correcta para ti puede tomar algunos clics. Por ejemplo, Xcode 3.2 es la versión para OS X 10.6 Snow Leopard, 3.0 es la versión para OS X 10.5 Leopard, etc.</p>\n<p>Es una descarga muy grande y tomará algún tiempo en completarse. Una vez que tengas el archivo, instálalo.</p>\n<p>Deberás instalar el kit &#39;<strong>Command Line Tools</strong>&#39; de XCode. Abre la pestaña &#39;Preferencias&#39;, haz clic en &#39;Descargas&#39; y luego en &#39;Instalar&#39; junto a &#39;Herramientas de línea de comandos&#39;. Ahora estamos listos para instalar un gestor de paquetes.</p>\n<p>El gestor de paquetes más fácil de instalar es <em>Homebrew</em>. Ve a <a href=\"https://brew.sh/index_es\">https://brew.sh/index_es</a> y revisa las instrucciones. Hay muchos comandos importantes, como wget, que no están incluidos de forma predeterminada en OS X. Este programa facilita la descarga y la instalación de todos los archivos necesarios.</p>\n<p>Para instalar <em>Homebrew</em>, abre la ventana de Terminal y escribe:</p>\n<pre><code class=\"language-bash\">/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;\n</code></pre>\n<p>Esta instalación de <em>Hombrew</em> utiliza el lenguaje de programación Ruby, integrado en OS X. Para ver si la instalación fue correcta, escribe la siguiente orden en la ventana de tu Terminal:</p>\n<pre><code class=\"language-bash\">brew\n</code></pre>\n<p>Si se ha instalado bien, debe aparecer una lista de opciones de documentación. Pero aún tenemos que ejecutar otro comando para asegurarnos de que todo funcione:</p>\n<pre><code class=\"language-bash\">brew doctor\n</code></pre>\n<p>Con <em>Homebrew</em> listo podemos instalar wget, que ahora será un paso fácil.</p>\n<pre><code class=\"language-bash\">brew install wget\n</code></pre>\n<p>Se procederá a descargar la versión más reciente de wget, que es wget 1.14.[^2] Después de que la secuencia de comandos deje de ejecutarse y vuelva a la ventana principal, escribe el siguiente comando en la terminal:</p>\n<pre><code class=\"language-bash\">wget\n</code></pre>\n<p>Si se instaló verás:</p>\n<pre><code>-&gt; Missing URL.\n</code></pre>\n<p>Si no, verás:</p>\n<pre><code>-&gt; command not found.\n</code></pre>\n<p>En este punto, deberías haber instalado wget correctamente. ¡Ahora todo está listo para seguir!</p>\n<h4 id=\"opción-dos-para-os-x\">Opción dos para OS X</h4>\n<p>Si por alguna razón no deseas instalar un administrador de paquetes, puedes descargar solo wget. Esto será apropiado si estás utilizando un administrador de paquetes diferente (como Mac Ports) o si deseas mantener tu infraestructura al mínimo. Sigue las mismas instrucciones para instalar Xcode y el conjunto de herramientas de línea de comandos.</p>\n<p>Luego puedes descargar una versión no compilada de wget desde el <a href=\"http://www.gnu.org/software/wget/\">sitio web de GNU</a>. Yo elegí descargar el archivo <code>wget-1.13.tar.gz</code>, que puedes encontrar siguiendo el enlace a cualquier página de descarga, ya sea <a href=\"http://ftp.gnu.org/gnu/wget/\">HTTP</a> o <a href=\"ftp://ftp.gnu.org/gnu/wget/\">FTP</a>). Descomprime haciendo doble clic en el archivo en tu directorio de inicio. En una Mac, este será su directorio: <code>/user/</code>; por ejemplo, mi nombre de usuario es ianmilligan y aparece junto a un icono de casa en mi Finder. Luego abre Terminal. Para este tutorial, hemos descargado <code>wget-1.13</code>.</p>\n<p>Tenemos que navegar primero al directorio en el que se encuentran los archivos wget. En la terminal, escribe:</p>\n<pre><code class=\"language-bash\">cd wget-1.13\n</code></pre>\n<p>Ten en cuenta que si has descargado una versión diferente de wget, los siguientes pasos funcionarán pero tendrás que reemplazar el número de la versión (aquí <code>1.13</code>) por el tuyo.</p>\n<p>Ahora necesitamos generar las instrucciones, o <code>makefile</code>, para el archivo. Esto es una especie de boceto del aspecto que tendrá el archivo final. Escribe:</p>\n<pre><code class=\"language-bash\">./configure –with-ssl=openssl\n</code></pre>\n<p>Ahora que tenemos el proyecto abocetado, ordenemos a la computadora que lo siga. Escribe:</p>\n<pre><code class=\"language-bash\">make\n</code></pre>\n<p>Ahora necesitas crear el archivo final. Al escribir antes el comando sudo, estás ejecutando los comandos siguientes con los privilegios de seguridad más altos. Esto le permite a la computadora instalar el archivo en tu sistema.</p>\n<pre><code class=\"language-bash\">sudo make install\n</code></pre>\n<p>En este punto del proceso tendrás que introducir la contraseña de tu computadora en el prompt que aparezca. Escríbela.</p>\n<p>Deberás haber instalado wget.</p>\n<h3 id=\"instrucciones-para-windows\">Instrucciones para Windows</h3>\n<p>La forma más fácil es descargar una versión funcional. Para hacerlo, visita <a href=\"https://eternallybored.org/misc/wget/\">este sitio web</a> y descarga <code>wget.exe</code>. Al momento de escribir este tutorial es la versión 1.17.1, y debe descargar el archivo binario de 32 bits. El archivo es el segundo enlace en la columna binaria de 32 bits, titulada simplemente <code>wget.exe</code>.</p>\n<p>Si colocas <code>wget.exe</code> en tu directorio <code>C:\\Windows</code>, puedes usar wget desde cualquier lugar de tu computadora. Esto hará tu vida más fácil ya que no tendrás que preocuparte por ejecutar siempre wget desde un solo lugar en tu sistema. Si está en este directorio, Windows sabrá que el comando se puede usar en cualquier parte en el que se encuentra la ventana de tu terminal.</p>\n<h2 id=\"segundo-paso-aprender-acerca-de-la-estructura-de-wget---descargar-un-conjunto-específico-de-archivos\">Segundo paso: Aprender acerca de la estructura de Wget - Descargar un conjunto específico de archivos</h2>\n<p>En este punto, las personas usuarias de las tres plataformas deben estar en la misma página. Usamos wget a través de la interfaz de línea de comandos de nuestro sistema operativo (introducido anteriormente como <code>Terminal</code> para usuarios de Mac y Linux, donde ha estado jugando con algunos comandos de Python). Debes usar su línea de comandos en lugar de Komodo Edit que puedes haber usado en otras lecciones.</p>\n<p>La documentación completa para wget se puede encontrar en la página del <a href=\"http://www.gnu.org/software/wget/manual/wget.html\">Manual de wget de GNU</a>.</p>\n<p>Tomemos un ejemplo de conjunto de datos. Digamos que deseas descargar todos los documentos alojados en el sitio web ActiveHistory.ca. Todos están ubicados en: <a href=\"http://activehistory.ca/papers/\">http://activehistory.ca/papers/</a>; en el sentido de que están todos contenidos en el directorio <code>/papers/</code>. Por ejemplo, el noveno documento publicado en el sitio web es <a href=\"http://activehistory.ca/papers/historypaper-9/\">http://activehistory.ca/papers/historypaper-9/</a>. Piensa en esta estructura de la misma forma que los directorios en tu propia computadora. Si tienes una carpeta con la etiqueta <code>/Historia/</code>, es probable que contenga varios archivos dentro de ella. La misma estructura es válida para los sitios web y estamos usando esta lógica para decirle a nuestra computadora qué archivos queremos descargar.</p>\n<p>Si deseas descargarlos todos manualmente deberás escribir un programa personalizado o hacer clic derecho en cada papel para hacerlo. Si los archivos están organizados de una manera que se ajuste a tus necesidades de investigación, wget es el abordaje más rápido.</p>\n<p>Para asegurarte que wget está trabajando, prueba lo siguiente.</p>\n<p>En tu directorio de trabajo, crea un nuevo directorio. Llamémoslo <code>wget-activehistory</code>. Puedes hacer esto utilizando tu Finder / Windows, o si estás en una ventana de Terminal en esa ruta, puedes escribir:</p>\n<pre><code class=\"language-bash\">mkdir wget-activehistory\n</code></pre>\n<p>Ahora tienes un directorio en el que trabajaremos. Abre la interfaz de la línea de comandos y navega al directorio <code>wget-activehistory</code>. Como recordatorio, recuerda que puedes escribir:</p>\n<pre><code class=\"language-bash\">cd [directory]\n</code></pre>\n<p>... para navegar a un directorio determinado. Si has creado este directorio en tu directorio de inicio, al escribir <code>cd wget-activehistory</code> podrás moverte a tu nuevo directorio.</p>\n<p>Escribe la orden siguiente:</p>\n<pre><code class=\"language-bash\">wget http://activehistory.ca/papers/\n</code></pre>\n<p>Después de algunos mensajes iniciales, verás algo parecido a lo siguiente (por supuesto que las cifras, las fechas y algunos detalles serán diferentes):</p>\n<pre><code>Saving to: `index.html.1&#39;\n\n[] 37,668 --.-K/s in 0.1s\n\n2012-05-15 15:50:26 (374 KB/s) - `index.html.1&#39; saved [37668]\n</code></pre>\n<p>Wget descargó la primera página de <a href=\"http://activehistory.ca/papers/\">http://activehistory.ca/papers/</a>, que contiene el índice de los documentos, a tu nuevo directorio. Si lo abres, verás el texto principal en la página de inicio de ActiveHistory.ca. Así que de un golpe ya hemos descargado algo rápidamente.</p>\n<p>Pero lo que queremos hacer ahora es descargar cada uno de los papeles. Así que necesitamos agregar algunos comandos a wget.</p>\n<p>Wget opera sobre las siguientes bases generales:</p>\n<pre><code class=\"language-bash\">wget [options] [URL]\n</code></pre>\n<p>Acabamos de aprender cosas sobre el componente [URL] en el ejemplo anterior, ya que le indica al programa a dónde ir. Sin embargo, las opciones le dan al programa un poco más de información sobre lo que queremos hacer. El programa sabe que una opción es una opción por la presencia de un guión antes de la variable. Esto le permite saber la diferencia entre la URL y las opciones. Así que vamos a aprender algunos comandos ahora:</p>\n<pre><code>-r\n</code></pre>\n<p>La recuperación recursiva es la parte más importante de wget. Lo que esto significa es que el programa comienza siguiendo los enlaces del sitio web y también los descarga. Entonces, por ejemplo, <a href=\"http://activehistory.ca/papers/\">http://activehistory.ca/papers/</a> tiene un enlace a <a href=\"http://activehistory.ca/papers/historypaper-9/\">http://activehistory.ca/papers/historypaper-9/</a>, por lo que también se descargará si utilizamos la recuperación recursiva. Sin embargo, también seguirá a cualquier otro enlace: si hubiera un enlace a <a href=\"http://uwo.ca\">http://uwo.ca</a> en algún lugar de esa página, seguiría eso y lo descargaría también. De forma predeterminada, <code>-r</code> envía wget a una profundidad de cinco sitios después del primero. Esto es siguiendo los enlaces, hasta un límite de cinco clics después del primer sitio web. En este punto, será bastante indiscriminado. Así que necesitamos más comandos:</p>\n<pre><code class=\"language-bash\">--no-parent\n</code></pre>\n<p>(El doble guión indica el texto completo de un comando. Todos los comandos también tienen una versión corta, éste podría iniciarse usando -np).</p>\n<p>Esto es muy importante. Quiere decir que wget debe seguir los enlaces pero no más allá del último directorio principal. En nuestro caso, eso significa que no irá a ninguna sitio que no sea parte de la jerarquía de <a href=\"http://activehistory.ca/papers/\">http://activehistory.ca/papers/</a>. Si se tratara de una ruta larga como <a href=\"http://niche-canada.org/projects/events/new-events/not-yet-happened-events/\">http://niche-canada.org/projects/events/new-events/not-yet-happened-events/</a>, solo encontraría archivos en la carpeta <code>/not-yet-happened-events/</code>. Es un comando crítico para delimitar tu búsqueda.</p>\n<p>Aquí una representación gráfica:</p>\n<p>{% include figure.html filename=&quot;active-history-chart_edited-1.jpg&quot; caption=&quot;Representación gráfica de cómo trabaja el comando &#39;no-parent&#39; en wget&quot; %}</p>\n<p>Finalmente, si deseas navegar fuera de una jerarquía, es mejor delimitar qué tan lejos quieres ir. El valor predeterminado es seguir cada enlace y mantener un límite de cinco páginas desde la primera página. Sin embargo, tal vez solo quieras seguir un enlace y detenerte allí. En ese caso, podría escribir <code>-l 2</code>, lo cual nos lleva a una profundidad de dos páginas web. Ten en cuenta que esto es una &#39;L&#39; minúscula, no un número 1.</p>\n<pre><code class=\"language-bash\">-l 2\n</code></pre>\n<p>Si estos comandos ayudan a dirigir wget, también debemos agregar algunos más para ser amables con los servidores y para evitar que las contramedidas automáticas del sitio detecten que el servidor está siendo atacado. Para ello, hay dos comandos esenciales adicionales:</p>\n<pre><code class=\"language-bash\">-w 10\n</code></pre>\n<p>No es correcto solicitar demasiadas peticiones a la vez a un servidor web. También hay otras personas que esperan información, por lo que es importante compartir la carga. El comando <code>-w 10</code> marca una espera de diez segundos entre las solicitudes que hacemos al servidor. Puedes acortar esto, ya que diez segundos es bastante largo. En mis propias búsquedas, a menudo uso una espera de 2 segundos. En raras ocasiones, puede encontrarse con un sitio que bloquee la descarga automática por completo. Los términos de servicio del sitio web, que debes consultar, pueden no mencionar una política de descarga automatizada. Pero los pasos para prohibirlo pueden incorporarse en la arquitectura de su sitio web. En casos tan raros, puede usar el comando <code>––random-wait</code> que variará la espera entre 0,5 y 1,5 veces el valor que proporciones aquí.</p>\n<p>Otro aspecto crítico es limitar el ancho de banda que utilizarás en la descarga:</p>\n<pre><code class=\"language-bash\">--limit-rate=20k\n</code></pre>\n<p>Este es otro comando importante y &quot;educado&quot;. No deseas utilizar demasiado ancho de banda de los servidores. Por lo tanto, este comando limitará la velocidad máxima de descarga a 20kb por segundo. La opinión varía acerca de cuál es una tasa límite adecuada. Probablemente podríamos llegar hasta unos 200 kb por segundo para archivos pequeños. Sin embargo, para no cargar demasiado al servidor, vamos a mantentenerlo en 20k. ¡Esto también nos mantendrá felices en <code>ActiveHistory.ca</code>!</p>\n<h3 id=\"tercer-paso-copia-mirror-de-un-sitio-completo\">Tercer paso: copia (mirror) de un sitio completo</h3>\n<p>Considerando todo esto descarguemos todos los documentos de ActiveHistory.ca. Ten en cuenta que la barra diagonal final en la URL es crítica. Si la omites, wget pensará que los documentos son un archivo en lugar de un directorio. Los directorios terminan en barras. Los archivos no lo hacen. El comando descargará la página completa de ActiveHistory.ca. El orden de las opciones no importa.</p>\n<pre><code class=\"language-bash\">wget -r --no-parent -w 2 --limit-rate=20k http://activehistory.ca/papers/\n</code></pre>\n<p>Va a ser más lento que antes, pero tu terminal comenzará a descargar todos los documentos de ActiveHistory.ca. Cuando haya terminado, debes tener un directorio etiquetado como <code>ActiveHistory.ca</code> que contendrá el subdirectorio <code>/papers/</code> perfectamente reflejado en tu sistema. Este directorio aparecerá en la ubicación desde la que ejecutaste el comando en tu línea de comandos, por lo que es probable que esté en tu directorio <code>USER</code>. Los enlaces serán reemplazados por enlaces internos a las otras páginas que ha descargado, por lo que realmente puedes tener un sitio ActiveHistory.ca completamente operativo en tu computadora. Esto te permite comenzar a jugar con él sin preocuparte por tu velocidad de internet.</p>\n<p>Para saber si la descarga fue un éxito, también tendrás un registro en la pantalla de comandos. Echa un vistazo para asegurarte de que todos los archivos se descargaron correctamente. Si no se han descargado, te avisará que has fallado.</p>\n<p>Si quieres descargar un sitio web completo, hay un comando incorporado para wget que te lo permite.</p>\n<pre><code>-m\n</code></pre>\n<p>Este comando significa &quot;espejo&quot; (<em>mirror</em>) y es muy útil para hacer copias de seguridad de un sitio web completo. Introduce el siguiente conjunto de comandos: <code>marcado de tiempo</code>(<em>time stamping</em>), que analiza la fecha del sitio y no lo reemplaza si ya tienes esa versión en tu sistema (que es muy útil para descargas repetidas), así como una recursión infinita (irá por tantas capas en el sitio como sea necesario). El comando para copiar completo el sitio ActiveHistory.ca sería:</p>\n<pre><code class=\"language-bash\">wget -m -w 2 --limit-rate=20k http://activehistory.ca\n</code></pre>\n<h2 id=\"una-herramienta-flexible-para-descargar-fuentes-de-internet\">Una herramienta flexible para descargar fuentes de Internet</h2>\n<p>A medida que tengas más comodidad usando la línea de comandos, verás que wget es un agregado útil a tu conjunto de herramientas digitales. Si hay un corpus completo de documentos de archivo que deseas descargar para minería de texto, si están organizados en un directorio y están todos juntos (lo que no es tan común como podría pensarse), con un comando wget rápido esto será más eficaz que hacer <em>scraping</em> en los enlaces con Python. Asimismo, puedes comenzar a descargar cosas directamente desde tu línea de comandos: programas, archivos, copias de seguridad, etc.</p>\n<h3 id=\"otras-lecturas\">Otras lecturas</h3>\n<p>Aquí solo he dado una instantánea de algunas de las funcionalidades de wget. Para más información, consulta el <a href=\"http://www.gnu.org/software/wget/manual/wget.html\">manual de wget</a>.</p>\n<h4 id=\"notas\">Notas</h4>\n<p>[^1]: Al momento de la traducción el más reciente es Mojave (OS-X 10.14), desde el 25 de septiembre de 2018.\n[^2]: La versión más reciente es wget 1.19, desde el 3 de febrero de 2017.</p>\n"}