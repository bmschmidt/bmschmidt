<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="description" content="" />
		<link rel="icon" href="/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		

		

		<link rel="stylesheet" href="/_app/assets/start-61d1577b.css">
		<link rel="modulepreload" href="/_app/start-a80c730b.js">
		<link rel="modulepreload" href="/_app/chunks/vendor-9b9d6288.js">
		<link rel="modulepreload" href="/_app/pages/__layout.svelte-de46afb2.js">
		<link rel="modulepreload" href="/_app/pages/_lang_/__layout.svelte-e75718c6.js">
		<link rel="modulepreload" href="/_app/chunks/stores-191d1505.js">
		<link rel="modulepreload" href="/_app/pages/_lang_/_lessons_/_slug_/index.svelte-efe77d76.js">

		<script type="module">
			import { start } from "/_app/start-a80c730b.js";
			start({
				target: document.querySelector("#svelte"),
				paths: {"base":"","assets":""},
				session: {},
				route: true,
				spa: false,
				trailing_slash: "never",
				hydrate: {
					status: 200,
					error: null,
					nodes: [
						import("/_app/pages/__layout.svelte-de46afb2.js"),
						import("/_app/pages/_lang_/__layout.svelte-e75718c6.js"),
						import("/_app/pages/_lang_/_lessons_/_slug_/index.svelte-efe77d76.js")
					],
					url: new URL("sveltekit://prerender/en/lessons/mapping-with-python-leaflet"),
					params: {lang:"en",lessons:"lessons",slug:"mapping-with-python-leaflet"}
				}
			});
		</script><script>
			if ('serviceWorker' in navigator) {
				navigator.serviceWorker.register('/service-worker.js');
			}
		</script>
	</head>
	<body>
		<div id="svelte">


The Programming Historian <a href="/en">English</a> <a href="/es">Spanish</a>
<br>
This is the en edition.

<h1>Web Mapping with Python and Leaflet</h1>

<!-- HTML_TAG_START --><p>{% include toc.html %}</p>
<h1 id="lesson-goals">Lesson Goals</h1>
<p>In this lesson, you will learn how to create a web map based on that data.  By the end of this lesson, you will be able to:</p>
<ul>
<li>Manipulate tabular data programmatically to extract geonames and create location-based data</li>
<li>Convert tabular data into a meaningful geographic data structure</li>
<li>Understand and apply the basic concepts of web mapping to design your own web map</li>
</ul>
<h2 id="getting-started">Getting Started</h2>
<h3 id="initial-setup">Initial Setup</h3>
<p>This lesson uses:</p>
<ul>
<li><a href="/lessons/?topic=python">python</a> (<a href="http://pip.readthedocs.org/en/stable/">pip</a>, <a href="https://github.com/geopy/geopy">geopy</a>, <a href="http://pandas.pydata.org/pandas-docs/stable/dsintro.html#dataframe">pandas</a>)</li>
<li><a href="http://leafletjs.com/">leaflet</a></li>
<li><a href="http://geojson.io/">geojson.io (from mapbox)</a></li>
<li><a href="https://www.javascript.com/">javascript</a> and <a href="https://jquery.com/">jquery</a></li>
</ul>
<p>Optional: If you wish to follow along with pre-made scripts you can find them in <a href="https://github.com/programminghistorian/jekyll/tree/gh-pages/assets/mapping-with-python-leaflet">this directory</a>.</p>
<p>To set up your working environment:</p>
<ol>
<li>Create a directory for this project where you will keep all of your scripts and files that you will work from</li>
<li>If you have a text editor where you can work from the directory of your project, import that directory. You can use editors such as <a href="http://www.barebones.com/products/textwrangler/">TextWrangler</a> for OS X, <a href="https://notepad-plus-plus.org/">Notepad++</a> for Windows, or <a href="http://www.sublimetext.com/">Sublime Text</a>.
If you are using a code editor such as Sublime Text, to import the folder you could drag and drop the folder that you want to work from into your editor window. Once you&#39;ve done that, the directory will appear on the left hand sidebar as you root folder. If you click on your folder, you&#39;ll be able to see the contents of your folder. Importing a folder allows you to easily work with the files in your project. If you need to work with multiple files and directories in directories, this will make it easier to search through these files, switch between them while you&#39;re working and keep you organized.</li>
<li>(Optional) It is recommended to use a <a href="http://docs.python-guide.org/en/latest/dev/virtualenvs/">Python virtual environment</a> to store the dependencies and versions required for your specific project.</li>
</ol>
<h3 id="getting-data-download-the-csv">Getting Data: Download the CSV</h3>
<p>We&#39;re going to start with a plain comma-separated values (CSV) data file and create a web map from it.</p>
<p><a href="/assets/mapping-with-python-leaflet/census.csv">The data file can be downloaded here</a>. You can grab this by either opening the link in your browser and saving the page, or you can use the curl command from your command line:</p>
<p><code>curl -O https://programminghistorian.org/assets/mapping-with-python-leaflet/census.csv</code></p>
<p>The original source of this data is from the <a href="http://data.london.gov.uk/dataset/historic-census-population">Greater London Authority London Datastore</a>.</p>
<h2 id="geocoding-with-python">Geocoding with Python</h2>
<h3 id="geocode-the-placenames-in-the-csv-using-geopy-pandas">Geocode the placenames in the CSV using Geopy, Pandas</h3>
<p>Now that we have data, we will use this as our source to make a web map. Web maps typically represent locations and features from geographic data formats such as geoJSON and KML. Every location in a geographic data file can be considered to have geometry (such as points, lines, polygons) as well as additional properties. Web maps typically understand locations as a series of coordinates. For example, 43.6426,-79.3871 would represent the exact coordinates of the <a href="https://en.wikipedia.org/wiki/CN_Tower">CN Tower in Toronto</a>.</p>
<p>In our data file, we have a list of placenames in our CSV data (the Area Name column), but no coordinates. What we want to do then is to somehow generate coordinates from these locations. This process is called geocoding.</p>
<p>So here is our first problem to solve:  how can we geocode placenames? How could we take an entry such as &quot;CN Tower&quot; and add the coordinates 43.6426,-79.3871 to it automatically?</p>
<p>To clarify, we need to figure out how to gather coordinates for a location for each row of a CSV file in order to display these locations on a web map.</p>
<p>There&#39;s a simple way to do this: you can look up a coordinate online in Google Maps and put each coordinate in your spreadsheet manually.  But, if you had 5,000 points the task becomes a little bit more daunting. If you&#39;re faced with a repetitive task, it might be worthwhile to approach it programmatically.</p>
<p>If you&#39;re familiar with <em>Programming Historian</em>, you might have already noticed that there are many <a href="/lessons/?topic=python">lessons available on how to use Python</a>.  Python is a great beginner programming language because it is easy to read and happens to be used a lot in GIS applications to optimize workflows.  One of the biggest advantages to Python is the impressive amount of libraries which act like pluggable tools to use for many different tasks.  Knowing that this is a good programmatic approach, we&#39;re now going to build a Python script that will automate geocode every address for us.</p>
<p><a href="https://github.com/geopy/geopy">Geopy</a> is a Python library that gives you access to the various geocoding APIs.  Geopy makes it easy for Python developers to locate the coordinates of addresses, cities, countries, and landmarks across the globe using third-party geocoders and other data sources. Geopy includes geocoders built by OpenStreetMap Nominatim, ESRI ArcGIS, Google Geocoding API (V3), Baidu Maps, Bing Maps API, Yahoo! PlaceFinder, Yandex, IGN France, GeoNames, NaviData, OpenMapQuest, What3Words, OpenCage, SmartyStreets, geocoder.us, and GeocodeFarm geocoder services.</p>
<p><a href="http://pandas.pydata.org/pandas-docs/stable/dsintro.html#dataframe">Pandas</a> is another python library that we will use.  It&#39;s very popular library amongst scientists and mathematicians to manipulate and analyse data.</p>
<p>Finally, <a href="http://pip.readthedocs.org/en/stable/">Pip</a> is a very useful package manager to help you install things like Geopy and Pandas! If you&#39;ve <a href="/lessons/introduction-and-installation">already installed Python</a> and <a href="/lessons/installing-python-modules-pip">installed pip</a>, type <code>pip list</code> to see if you already have the geopy and pandas packages installed. If you do not have pip installed, you can download <a href="https://bootstrap.pypa.io/get-pip.py">get-pip.py</a>, then from your command line go to the directory where get-pip.py is located and run</p>
<p><code>python get-pip.py </code></p>
<p>For the most up to date instructions, you can visit <a href="http://pip.readthedocs.org/en/stable/installing/">pip&#39;s installation manual</a>.</p>
<p>To install Geopy and Pandas, open your <a href="/lessons/intro-to-bash">command line (using this lesson as a guideline if necessary)</a> and install the Geopy and Pandas libraries:</p>
<p>On OS X or Linux, the following commands will install the necessary packages:</p>
<pre><code class="language-bash">pip install numpy
pip install python-dateutil
pip install pytz
pip install geopy
pip install pandas
</code></pre>
<p>Note: We are installing numpy, python-dateutil, and pytz because pandas <a href="http://pandas.pydata.org/pandas-docs/stable/install.html#dependencies">requires them</a>.</p>
<p>For Windows, you may need to install <a href="https://wiki.python.org/moin/WindowsCompilers">Microsoft Visual C++ Compiler for Python</a>. Set the environmental variables to recognize python and pip from the command line:</p>
<pre><code>setx  PATH &quot;%PATH%;C:\Python27&quot;
setx  PATH &quot;%PATH%;C:\Python27\Scripts&quot;
</code></pre>
<p>If you keep getting an error when you&#39;re trying to install these libraries, you may need to use <code>sudo pip install</code> instead of just <code>pip install</code>. You may also need to upgrade your libraries if you&#39;ve installed them earlier and you find that you&#39;re encountering an error when using Python (i.e. an ImportError). In order to do so, the following command works:</p>
<pre><code class="language-bash">pip install python --upgrade
</code></pre>
<p>Repeat for the other dependencies listed above.</p>
<p>Now we&#39;re going to start building our script. We&#39;re going to go through the script, line by line, and then run it through the command line at the end. To get started, open your text editor and save your blank document as a python script (name it <code>geocoder.py</code>).  For the first part of your Python script, you will want to import your libraries and your data:</p>
<pre><code class="language-python">import geopy
import pandas
from geopy.geocoders import Nominatim
# versions used: geopy 2.2.0, pandas 1.3.3, python 3.7.5
</code></pre>
<p>In the code above, we are importing the different Python libraries that we will need to use later on in our script.  We import geopy, specifically the geopy.geocoders that we will call on later which is <a href="https://wiki.openstreetmap.org/wiki/Nominatim">Nominatim</a> and <a href="https://developers.google.com/maps/documentation/geocoding/start">Google Maps V3 API</a>, and we import pandas.</p>
<p>Then you want to create a function main() that reads your input CSV.</p>
<pre><code class="language-python">import geopy
import pandas
from geopy.geocoders import Nominatim
# versions used: geopy 2.2.0, pandas 1.3.3, python 3.7.5

def main():
    io = pandas.read_csv(&#39;census-historic-population-borough.csv&#39;, index_col=None, header=0, sep=&quot;,&quot;)
</code></pre>
<p>We are first using pandas&#39; pre-existing read_csv() function to open the CSV file. We pass the filepath to our data file in the first parameter, &#39;census-historic-population-borough.csv&#39;. If it was in a folder called &#39;data&#39;, you would put &#39;data/census-historic-population-borough.csv&#39;.  The second parameter, <code>index_col=None</code>, will number the rows to generate the index without using any column.  If we use <code>index_col=0</code>, it indexes the first column in your data as the row name. The third parameter, <code>header=0</code>, indicates that there is a header row, which is the first line of the spreadsheet (Note: Python uses &quot;0&quot; instead of &quot;1&quot; to indicate the first value in an index). The fourth parameter <code>sep=&quot;,&quot;</code> is where you indicate delimiter symbol that is used to split data into fields.  Since are using a comma separated values data format, we need to indicate that we are using a comma to split our data.</p>
<p>There are many other parameters you can use.  A full list is available in the pandas documentation on the <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html">read_csv() function</a>.</p>
<p>Next, we anticipate that when we geocode the csv we will get points in the format of (latitude, longitude). If we only want the latitude value of the point in a csv column, we will define a function to isolate that value. The same can be done for our longitude value.</p>
<pre><code class="language-python">import geopy
import pandas
# versions used: geopy 2.2.0, pandas 1.3.3, python 3.7.5

def main():
  io = pandas.read_csv(&#39;census-historic-population-borough.csv&#39;, index_col=None, header=0, sep=&quot;,&quot;)

def get_latitude(x):
  return x.latitude

def get_longitude(x):
  return x.longitude
</code></pre>
<p>Next, select the geolocator you want to use.  Here we&#39;re creating two geolocators: Open Street Map&#39;s Nominatim and Google&#39;s Geocoding API.  Here&#39;s a quick comparison:</p>
<table>
<thead>
<tr>
<th>Geolocator</th>
<th>Nominatim()</th>
</tr>
</thead>
<tbody><tr>
<td>affiliation</td>
<td>OpenStreetMap</td>
</tr>
<tr>
<td>application use</td>
<td>single-threaded applications, can only run geolocator one process at a time</td>
</tr>
<tr>
<td>capabilities for app development</td>
<td>can geocode based on user-input</td>
</tr>
<tr>
<td>request limit</td>
<td>1 request/s or timeout</td>
</tr>
<tr>
<td>performance test on census data</td>
<td>33.5s</td>
</tr>
</tbody></table>
<p>You can also choose a different geolocator from the list found in <a href="http://geopy.readthedocs.org/">the geopy documentation</a>. GoogleV3 is a geocoder compatible with geopy, it is a reliable geolocator choice because of their large geographic data coverage. However, since July 2018 an API key is required, and you need to enable billing in Google Cloud to use it. For more information about choosing geolocators, you can follow the discussion in the <a href="https://github.com/geopy/geopy/issues/90">geopy repository on Github</a>.</p>
<p>To use a geolocator, import them and assign a variable name (in this case we use the name geolocator):</p>
<pre><code class="language-python">import geopy
import pandas
from geopy.geocoders import Nominatim
# versions used: geopy 2.2.0, pandas 1.3.3, python 3.7.5

def main():
  io = pandas.read_csv(&#39;census-historic-population-borough.csv&#39;, index_col=None, header=0, sep=&quot;,&quot;)

  def get_latitude(x):
    return x.latitude

  def get_longitude(x):
    return x.longitude

geolocator = Nominatim()
</code></pre>
<p>Finally, using pandas you want to create a column in your spreadsheet called &#39;latitude&#39;.  The script will read the existing &#39;Area_Name&#39; data column, run the geopy <a href="http://geopy.readthedocs.io/en/latest/#module-geopy.geocoders">geolocator</a> on the column using pandas&#39; <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.apply.html">apply function</a>, and generate a latitude coordinate in that column.  The same transformation will occur in the &#39;longitude&#39; column.  Once this is finished it will output a new CSV file with those two columns:</p>
<pre><code class="language-python">import geopy
import pandas
from geopy.geocoders import Nominatim
# versions used: geopy 2.2.0, pandas 1.3.3, python 3.7.5

def main():
  io = pandas.read_csv(&#39;census-historic-population-borough.csv&#39;, index_col=None, header=0, sep=&quot;,&quot;)

  def get_latitude(x):
    return x.latitude

  def get_longitude(x):
    return x.longitude

  geolocator = Nominatim()

  geolocate_column = io[&#39;Area_Name&#39;].apply(geolocator.geocode)
  io[&#39;latitude&#39;] = geolocate_column.apply(get_latitude)
  io[&#39;longitude&#39;] = geolocate_column.apply(get_longitude)
  io.to_csv(&#39;geocoding-output.csv&#39;)
</code></pre>
<p>If we didn&#39;t have the <code>.apply(get_latitude)</code> part of the code, we&#39;d get the full point data. For instance, if we were again geocoding the CN Tower and used just <code>.apply(geolocator.geocode)</code>, we would get 43.6426,-79.3871 in our column. Adding the additional <code>.apply(get_latitude)</code> would mean that we&#39;d only get 43.6426 in our column.</p>
<p>To finish off your code, it&#39;s good practice to make your python modular, that way you can plug it in and out of other applications (should you want to use this script as part of another program). This is what your final python script should look like:</p>
<pre><code class="language-python">import geopy
import pandas
from geopy.geocoders import Nominatim
# versions used: geopy 2.2.0, pandas 1.3.3, python 3.7.5

def main():
  io = pandas.read_csv(&#39;census-historic-population-borough.csv&#39;, index_col=None, header=0, sep=&quot;,&quot;)

  def get_latitude(x):
    return x.latitude

  def get_longitude(x):
    return x.longitude

  geolocator = Nominatim(user_agent=&quot;email@email.com&quot;)

  geolocate_column = io[&#39;Area_Name&#39;].apply(geolocator.geocode)
  io[&#39;latitude&#39;] = geolocate_column.apply(get_latitude)
  io[&#39;longitude&#39;] = geolocate_column.apply(get_longitude)
  io.to_csv(&#39;geocoding-output.csv&#39;)

if __name__ == &#39;__main__&#39;:
  main()
</code></pre>
<p>Do you have the script saved and ready to go? Good.  Run the script from your command line by typing:</p>
<pre><code class="language-bash">python geocoder.py
</code></pre>
<p>It takes a few seconds and may take longer depending on the geolocator you use. Once the script finishes running, you should have coordinates for every Area_Name.</p>
<p><em>Tip 1: If you want to pass the filenames from the command line rather than changing the input file name in the python script everytime, you can import the python &#39;sys&#39; library to pass through arguments. Your code might look like this:</em></p>
<pre><code class="language-python">import geopy, sys
import pandas
from geopy.geocoders import Nominatim
# versions used: geopy 2.2.0, pandas 1.3.3, python 3.7.5

inputfile=str(sys.argv[1])
namecolumn=str(sys.argv[2])

def main():
  io = pandas.read_csv(inputfile, index_col=None, header=0, sep=&quot;,&quot;)

def get_latitude(x):
  return x.latitude

  def get_longitude(x):
    return x.longitude

  geolocator = Nominatim()

  geolocate_column = io[namecolumn].apply(geolocator.geocode)
  io[&#39;latitude&#39;] = geolocate_column.apply(get_latitude)
  io[&#39;longitude&#39;] = geolocate_column.apply(get_longitude)
  io.to_csv(&#39;geocoding-output.csv&#39;)

if __name__ == &#39;__main__&#39;:
  main()
</code></pre>
<p>To run your python script your command would look like this:</p>
<p><code>python geocoder.py census-historic-population-borough.csv Area_Name</code></p>
<p><em>Tip 2:
If you run geocoder.py too many times you might get a timeout error.</em></p>
<p>The error will look like this if you use the Nominatim geocoder:</p>
<p><code>geopy.exc.GeocoderTimedOut: Service timed out</code></p>
<p>To address the timeout error, you could add the parameter <code>timeout</code>, which specifies the time, in seconds, to wait for the geocoding service to respond before raising a geopy.exc.GeocoderTimedOut exception. So your geolocator declaration will look like this:</p>
<p><code>geolocator = Nominatim(user_agent=&quot;email@email.com&quot;, timeout=5)</code></p>
<h2 id="transforming-data-with-python">Transforming Data with Python</h2>
<h3 id="making-geojson">Making GeoJSON</h3>
<p>Now that you have a spreadsheet full of coordinate data, we can convert the CSV spreadsheet into a format that web maps like, like GeoJSON.  GeoJSON is a web mapping standard of JSON data.  There are a couple of ways to make GeoJSON:</p>
<p>The easiest, recommended way is to use a UI tool developed by Mapbox called <a href="http://geojson.io">geojson.io</a>.  All you have to do is click and drag your csv file into the data window (the right side of the screen, next to the map), and it will automatically format your data into GeoJSON for you. You can select the &#39;GeoJSON&#39; option under &#39;Save.&#39;  Save your GeoJSON file as <code>census.geojson</code>.</p>
<p>{% include figure.html filename=&quot;webmap-01-geojsonio.gif&quot; caption=&quot;Drag and Drop GeoJSON creation!&quot; %}</p>
<p>Image Credit: with permission from Mauricio Giraldo Arteaga, NYPL Labs</p>
<p>You can also do it from the command line, using the <a href="https://github.com/mapbox/csv2geojson">csv2geojson library</a> that powers geojson.io.</p>
<p>Test this data out by importing it again into geojson.io.  You should see points generated in the preview window.  That&#39;s your data!</p>
<h3 id="you-finally-have-geojson-but-you-need-to-do-some-cleaning">You finally have GeoJSON... but you need to do some cleaning!</h3>
<p>If you&#39;ve tested your GeoJSON data, you might notice that not every point is geolocated correctly.  We know that every Area_Name is a borough of London, but points appear all over United Kingdom, and some aren&#39;t located even in the country.</p>
<p>To make the results more accurate, save another copy of the census-historic-population-borough.csv file, calling it census_country.csv and include an additional column called &#39;Country&#39; and put &#39;United Kingdom&#39; in every row of your data. For even greater accuracy add &#39;City&#39; and put &#39;London&#39; in every row of your data to provide additional context for your data.</p>
<p>{% include figure.html filename=&quot;webmap-02-countrycolumn.png&quot; caption=&quot;A new Country column&quot; %}</p>
<p>Make a copy of your geocoder.py python script, calling it geocoder-helpercolumn.py. Remove the following lines:</p>
<pre><code class="language-python">  geolocate_column = io[namecolumn].apply(geolocator.geocode)
  io[&#39;latitude&#39;] = geolocate_column.apply(get_latitude)
  io[&#39;longitude&#39;] = geolocate_column.apply(get_longitude)
</code></pre>
<p> and replacing it with the following that combines the Area_Name and Country or City column to geocode your data:</p>
<pre><code class="language-python">  io[&#39;helper&#39;] = io[&#39;Area_Name&#39;].map(str) + &quot; &quot; + io[&#39;Country&#39;].map(str)
  geolocate_column = io[&#39;helper&#39;].apply(geolocator.geocode)
  io[&#39;latitude&#39;] = geolocate_column.apply(get_latitude)
  io[&#39;longitude&#39;] = geolocate_column.apply(get_longitude)
</code></pre>
<p>Note that we added the .map(str) function. This is a pandas function that is allowing you to concatenate two DataFrame columns into a new, single column (helper) using the syntax format:</p>
<pre><code class="language-python">df[&#39;newcol&#39;] = df[&#39;col1&#39;].map(str) + df[&#39;col2&#39;].map(str)
</code></pre>
<p>You will also want to comment out and commenting out <code>namecolumn=str(sys.argv[2])</code> since we are now directly specifying the column that we are using in the script.</p>
<p>Your final script should look like this:</p>
<pre><code class="language-python">import geopy, sys
import pandas
from geopy.geocoders import Nominatim

inputfile=str(sys.argv[1])
# namecolumn=str(sys.argv[2])

def main():
  io = pandas.read_csv(inputfile, index_col=None, header=0, sep=&quot;,&quot;)

  def get_latitude(x):
    return x.latitude

  def get_longitude(x):
    return x.longitude

  # geolocator = Nominatim(timeout=5)
  # uncomment the geolocator you want to use
  # change the timeout value if you get a timeout error, for instance, geolocator = Nominatim(timeout=60)
  io[&#39;helper&#39;] = io[&#39;Area_Name&#39;].map(str) + &quot; &quot; + io[&#39;Country&#39;].map(str)
  geolocate_column = io[&#39;helper&#39;].apply(geolocator.geocode)
  io[&#39;latitude&#39;] = geolocate_column.apply(get_latitude)
  io[&#39;longitude&#39;] = geolocate_column.apply(get_longitude)
  io.to_csv(&#39;geocoding-output-helper.csv&#39;)

if __name__ == &#39;__main__&#39;:
  main()
</code></pre>
<p>Which you can now run by using the command:</p>
<pre><code>python geocoder-helpercolumn.py census_country.csv
</code></pre>
<p>Turn your clean data into GeoJSON by saving it as <code>census.geojson</code> and test it out at <a href="http://geojson.io">geojson.io</a>. Remember, drag the new CSV you created (<code>census_country.csv</code> into the window to create that beautiful JSON). Do the results look better now? Good!</p>
<h2 id="using-leaflet-to-create-a-web-map">Using Leaflet to Create a Web Map</h2>
<h3 id="i-now-have-clean-geojson-data--lets-make-a-map">I now have clean GeoJSON data.  Lets make a map!</h3>
<p>Setup a test web server to test out our maps. A web server is used to serve content from your directory to your browser.</p>
<p> If you&#39;re in your working directory, from the command line, run:</p>
<p><code>python -m SimpleHTTPServer</code> or <code>python3 -m http.server</code> (for Python3)</p>
<p>SimpleHTTPServer is a Python module. If you want to change the server to port 8080 (or any other port), use</p>
<p><code>python -m SimpleHTTPServer 8080</code> or <code>python3 -m http.server 8080</code> (for Python3)</p>
<p>In your browser go to <a href="http://localhost:8080">http://localhost:8080</a> and you should see the files you&#39;ve been working with so far.</p>
<p>Now in your text editor open a new document and save it as an html file (mymap.html).  If you want to do a quick test, copy and paste the text below, refresh your <a href="http://localhost:8080">http://localhost:8080</a> and open the html file in your browser.</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;head&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css&quot; /&gt;
&lt;script src=&quot;http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://code.jquery.com/jquery-2.1.4.min.js&quot;&gt;&lt;/script&gt;


&lt;style&gt;
#my-map {
    width:960px;
    height:500px;
}
&lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div id=&quot;my-map&quot;&gt;&lt;/div&gt;
&lt;script&gt;
window.onload = function () {
    var basemap = L.tileLayer(&#39;http://{s}.tile.osm.org/{z}/{x}/{y}.png&#39;, {
        attribution: &#39;&amp;copy; &lt;a href=&quot;http://osm.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt; contributors&#39;
    });

    $.getJSON(&quot;census.geojson&quot;, function(data) {

    var geojson = L.geoJson(data, {
      onEachFeature: function (feature, layer) {
        layer.bindPopup(feature.properties.Area_Name);
      }
    });

    var map = L.map(&#39;my-map&#39;)
    .fitBounds(geojson.getBounds());
//    .setView([0.0,-10.0], 2);

    basemap.addTo(map);
    geojson.addTo(map);
  });

};
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Do you see a map now?  Good! If not, you can troubleshoot by inspecting the browser, or by going back and retracing your steps.</p>
<h3 id="what-did-i-just-make">What did I just make?</h3>
<p>You made a web map!  Web maps use map tiles, which are pixel based images (rasters) of maps that contain geographical data. This means that each pixel of a map tile has been georeferenced, or assigned a coordinate based on the location that they represent.  When you zoom in and out of a web map, you are getting a whole new set of tiles to display at each zoom level. GeoJSON (which you are now familiar with) is a widely used data standard for web mapping.  In our example, we are using an open-source Javascript library called <a href="http://leafletjs.com/reference.html">Leaflet</a> to help us build our web map. The benefits of using an open-source library such as Leaflet is the flexibility you get and with developing and customizing your map, without worry of the technology being deprecated or no longer supported that is beyond your control.  With frameworks like Leaflet or Google Maps Javascript API, you&#39;re not building a map completely from scratch, rather, you&#39;re using pre-written functions and controls that helps you customize your own map in code.</p>
<p>Lets go through what each part of the code is doing. But first, it&#39;s best practice to maintain your html, css, js in different files so that the web map&#39;s content, presentation and behaviour layers are kept separate (though it&#39;s not always possible). This adds a bit more structure to your code, making it easier for you and others to understand. It will be easier to focus on certain parts of the code when you&#39;re going back and making changes. So here is our code split into three files:</p>
<p>mymap.html</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;head&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css&quot; /&gt;
&lt;script src=&quot;http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://code.jquery.com/jquery-2.1.4.min.js&quot;&gt;&lt;/script&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot; /&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div id=&quot;my-map&quot;&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;script src=&#39;leafletmap.js&#39;&gt;&lt;/script&gt;

&lt;/html&gt;
</code></pre>
<p>style.css</p>
<pre><code class="language-css">#my-map {
    width:960px;
    height:500px;
}
</code></pre>
<p>leafletmap.js</p>
<pre><code class="language-javascript">window.onload = function () {
    var basemap = L.tileLayer(&#39;http://{s}.tile.osm.org/{z}/{x}/{y}.png&#39;, {
        attribution: &#39;&amp;copy; &lt;a href=&quot;http://osm.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt; contributors&#39;
    });

    $.getJSON(&quot;census.geojson&quot;, function(data) {

    var geojson = L.geoJson(data, {
      onEachFeature: function (feature, layer) {
        layer.bindPopup(feature.properties.Area_Name);
      }
    });


    var map = L.map(&#39;my-map&#39;)
    .fitBounds(geojson.getBounds());

    basemap.addTo(map);
    geojson.addTo(map);
  });

};
</code></pre>
<p>Seems a bit easier to undestand now, doesn&#39;t it? Now lets look at what the html file is doing.</p>
<h4 id="mymaphtml-walkthrough">mymap.html walkthrough</h4>
<p>mymap.html</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;head&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css&quot; /&gt;
&lt;script src=&quot;http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://code.jquery.com/jquery-2.1.4.min.js&quot;&gt;&lt;/script&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot; /&gt;
&lt;/head&gt;
</code></pre>
<p>The above code is the first section, or header of your html document. We are linking to the external javascript library and css stylesheets provided by leaflet.  We&#39;re also linking to our own stylesheet, style.css.</p>
<pre><code class="language-html">
&lt;body&gt;
    &lt;div id=&quot;my-map&quot;&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;script src=&#39;leafletmap.js&#39;&gt;&lt;/script&gt;

&lt;/html&gt;
</code></pre>
<p>Next, we&#39;re declaring the body and where you want the map to go on your page. We&#39;re also linking to our own javascript file, leafletmap.js.</p>
<h4 id="stylecss-walkthrough">style.css walkthrough</h4>
<p>style.css</p>
<pre><code class="language-css">#my-map {
    width:960px;
    height:500px;
}
</code></pre>
<p>There&#39;s a bit of CSS styling here to specify the size of your map. Some optional styling will happen in your javascript file if you&#39;re using the Leaflet library.</p>
<h4 id="leafletmapjs-walkthrough">leafletmap.js walkthrough</h4>
<p>leafletmap.js</p>
<pre><code class="language-javascript">window.onload = function () {
    var basemap = L.tileLayer(&#39;http://{s}.tile.osm.org/{z}/{x}/{y}.png&#39;, {
        attribution: &#39;&amp;copy; &lt;a href=&quot;http://osm.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt; contributors&#39;
    });
</code></pre>
<p>The javascript file is what provides the behaviour, or functionality of our web map. It&#39;s what makes our web map come alive! In the code above, we&#39;re telling the javascript to load when the browser loads. We&#39;re creating our first map layer, which is your basemap.  The basemap is the tiles provided by OpenStreetMap that provides places and streetnames found on maps.</p>
<pre><code class="language-javascript">    $.getJSON(&quot;census.geojson&quot;, function(data) {

    var geojson = L.geoJson(data, {
      onEachFeature: function (feature, layer) {
        layer.bindPopup(feature.properties.Area_Name);
      }
    });
</code></pre>
<p>Next, we&#39;re loading our data as another map layer, <code>census.geojson</code>.  This data will have additional properties: each point of data is represented by an icon. It will look and behave like a popup so that when you click on the icon it will load information from your data file (in this case, the Area_Name).</p>
<pre><code class="language-javascript">   var map = L.map(&#39;my-map&#39;)
    .fitBounds(geojson.getBounds());

    basemap.addTo(map);
    geojson.addTo(map);
  });

};
</code></pre>
<p>Now we&#39;re creating the view for our map.  The boundary for our map will be based on the range of our data points in <code>census.geojson</code>.  You can also manually set your your viewport by using the <a href="http://leafletjs.com/reference.html#map-set-methods">setView property</a>. For example, if you&#39;re using <code>.setView([0.0,-10.0], 2)</code> , the viewport coordinates &#39;[0.0,-10.0], 2&#39; means that you&#39;re setting the centre of the map to be 0.0, -10.0 and at a zoom level of 2.</p>
<p>{% include figure.html filename=&quot;webmap-03-result.jpg&quot; caption=&quot;My Web Map&quot; %}</p>
<p>Finally, the map layers you created will be added to your map. Put it all together and hurrah, you&#39;ve got your web map!  Now lets play around with it. The following five exercises give you tasks to do to learn some of the other elements, with answers provided.</p>
<h3 id="exercise-1-default-viewports">Exercise 1: Default Viewports</h3>
<p>Let&#39;s change the map to use a viewport to 51.505 latitude, -0.09 longitude with a zoom level 9. To do this, we just need to edit one file: <code>leafletmap.js</code>.</p>
<pre><code class="language-javascript">window.onload = function () {
    var basemap = L.tileLayer(&#39;http://{s}.tile.osm.org/{z}/{x}/{y}.png&#39;, {
    attribution: &#39;&amp;copy; &lt;a href=&quot;http://osm.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt; contributors&#39;
  });

    $.getJSON(&quot;census.geojson&quot;, function(data) {

    var geojson = L.geoJson(data, {
      onEachFeature: function (feature, layer) {
        layer.bindPopup(feature.properties.Area_Name);
      }
    });


    var map = L.map(&#39;my-map&#39;)
    //.fitBounds(geojson.getBounds());
    .setView([51.505,-0.09], 9);
    //EDIT HERE

    basemap.addTo(map);
    geojson.addTo(map);
  });

};
</code></pre>
<p>What we&#39;ve done there is changed the <code>.fitBounds</code> to <code>.setView</code>, with the various options mentioned above. Try reloading the file, and you&#39;ll see it loads to the correct place.</p>
<p>{% include figure.html filename=&quot;webmap-05-exercise01.jpg&quot; caption=&quot;Exercise 01&quot; %}</p>
<h3 id="exercise-2-marker-properties">Exercise 2: Marker Properties</h3>
<p>Now let&#39;s add the 2001, 1981 and 1991 population property to each marker popup. You can use HTML to style your popup window. To do so, we again need to edit the javascript.</p>
<pre><code class="language-javascript">window.onload = function () {
    var basemap = L.tileLayer(&#39;http://{s}.tile.osm.org/{z}/{x}/{y}.png&#39;, {
    attribution: &#39;&amp;copy; &lt;a href=&quot;http://osm.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt; contributors&#39;
  });

    $.getJSON(&quot;census.geojson&quot;, function(data) {

    var geojson = L.geoJson(data, {
      onEachFeature: function (feature, layer) {
        layer.bindPopup(feature.properties.Area_Name + &#39;&lt;p&gt;&lt;b&gt; 2001 Population: &#39; + feature.properties.Pop_2001 + &#39;&lt;/b&gt;&lt;/p&gt;&#39; + &#39;&lt;p&gt;&lt;b&gt; 1981 Population: &#39; + feature.properties.Pop_1981 + &#39;&lt;/b&gt;&lt;/p&gt;&#39; + &#39;&lt;p&gt;&lt;b&gt; 1801 Population &#39; + feature.properties.Pop_1801 + &#39;&lt;/b&gt;&lt;/p&gt;&#39;);
        //EDIT HERE
      }
    });


    var map = L.map(&#39;my-map&#39;)
    //.fitBounds(geojson.getBounds());
    .setView([51.505,-0.09], 9);

    basemap.addTo(map);
    geojson.addTo(map);
  });

};
</code></pre>
<p>What we&#39;ve done here is edit the <a href="http://leafletjs.com/reference-1.2.0.html#geojson-oneachfeature">onEachFeature function</a>, which gets called for each feature (in this case, each marker popup) to add additional information about each marker contained in our <code>census.geojson</code> data. To add attribute information from our <code>census.geojson</code> file, we use the convention <code>feature.properties.ATTRIBUTE_NAME</code> to access the population data. In this case, we are adding <code>feature.properties.Pop_2001</code>, <code>feature.properties.Pop_1981</code>, and <code>feature.properties.Pop_1801</code>, and adding a bit of styling with html for readability.</p>
<p>{% include figure.html filename=&quot;webmap-06-exercise02.jpg&quot; caption=&quot;Exercise 02&quot; %}</p>
<h3 id="exercise-3-change-data-source">Exercise 3: Change Data Source</h3>
<p>Change the data source to a different dataset, as an example you can use the <a href="/assets/mapping-with-python-leaflet/exercises/exercise03/stations.geojson">stations.geojson</a> file.</p>
<p>To do this, we need to edit the javascript file.</p>
<pre><code class="language-javascript">window.onload = function () {
    var basemap = L.tileLayer(&#39;http://{s}.tile.osm.org/{z}/{x}/{y}.png&#39;, {
    attribution: &#39;&amp;copy; &lt;a href=&quot;http://osm.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt; contributors&#39;
  });

    $.getJSON(&quot;stations.geojson&quot;, function(data) {

    var geojson = L.geoJson(data, {
      onEachFeature: function (feature, layer) {
        layer.bindPopup(feature.properties.name + &#39;&lt;p&gt;&lt;b&gt; Line: &#39; + feature.properties.line + &#39;&lt;/b&gt;&lt;/p&gt;&#39;);
        //EDIT HERE
      }
    });


    var map = L.map(&#39;my-map&#39;)
    .fitBounds(geojson.getBounds());
    // .setView([51.505,-0.09], 9);
    // EDIT HERE

    basemap.addTo(map);
    geojson.addTo(map);
  });

};
</code></pre>
<p>Since we&#39;re loading a new dataset, we need a new view for our map. First, we&#39;ve replaced <code>census.geojson</code> with <code>stations.geojson</code> to our $getJSON request. Next, we add the attribute information found in our <code>stations.geojson</code> file, including the name (<code>feature.properties.name</code>) and line (<code>features.properties.line</code>). Finally, we are using the <code>.fitBounds</code> function so that the viewport automatically centers on our new set of data points.</p>
<p>{% include figure.html filename=&quot;webmap-07-exercise03.jpg&quot; caption=&quot;Exercise 03&quot; %}</p>
<h3 id="exercise-4-custom-basemap">Exercise 4: Custom Basemap</h3>
<p>Change your data source back to <code>census.geojson</code>. Change your basemap layer to a mapbox tileset.  You need to get a Mapbox account, create a map or style and get your Mapbox API access token.</p>
<p>{% include figure.html filename=&quot;webmap-04-mapboxAPI.png&quot; caption=&quot;Mapbox API&quot; %}</p>
<p>First, you will need to add a reference to the mapbox javascript and css libraries:</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;head&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css&quot; /&gt;
&lt;script src=&quot;http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://code.jquery.com/jquery-2.1.4.min.js&quot;&gt;&lt;/script&gt;
&lt;!-- EDIT HERE --&gt;
&lt;script src=&#39;https://api.mapbox.com/mapbox.js/v2.2.1/mapbox.js&#39;&gt;&lt;/script&gt;
&lt;link href=&#39;https://api.mapbox.com/mapbox.js/v2.2.1/mapbox.css&#39; rel=&#39;stylesheet&#39; /&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot; /&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;div id=&quot;my-map&quot;&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;script src=&#39;leafletmap.js&#39;&gt;&lt;/script&gt;

&lt;/html&gt;
</code></pre>
<p>Then we edit the javascript file:</p>
<pre><code class="language-javascript">
window.onload = function () {
     var basemap = L.tileLayer(&#39;http://{s}.tile.osm.org/{z}/{x}/{y}.png&#39;, {
     attribution: &#39;&amp;copy; &lt;a href=&quot;http://osm.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt; contributors&#39;
   });

    // EDIT HERE: get an access token, replace &#39;YOURTOKENHERE&#39; with something like &quot;pk.eyJ1Ijoia2ltcGhhbTU0IiwiYSI6IkdJX0tvM2cifQ.fVsdGC_QJrFYZ3SxZCsvhQ&quot;
    L.mapbox.accessToken = &#39;YOURTOKENHERE&#39;;

    // EDIT HERE: add the new baselayer style, replace &#39;YOURLINKHERE&#39; with something like &quot;kimpham54.au2i6bt9&quot;
    var basemap = L.tileLayer(&#39;https://api.mapbox.com/v4/kimpham54.au2i6bt9/{z}/{x}/{y}.png?access_token=&#39; + L.mapbox.accessToken, {
        attribution: &#39;&lt;a href=&quot;https://www.mapbox.com/tos/&quot;&gt;Mapbox&lt;/a&gt;&#39;
      });

    $.getJSON(&quot;stations.geojson&quot;, function(data) {

    var geojson = L.geoJson(data, {
      onEachFeature: function (feature, layer) {
        layer.bindPopup(feature.properties.name + &#39;&lt;p&gt;&lt;b&gt; Line: &#39; + feature.properties.line + &#39;&lt;/b&gt;&lt;/p&gt;&#39;);
        // EDIT HERE
      }
    });


    var map = L.map(&#39;my-map&#39;)
    .fitBounds(geojson.getBounds());
    //.setView([51.505,-0.09], 9);
    // EDIT HERE

    basemap.addTo(map);
    geojson.addTo(map);
  });

};
</code></pre>
<p>In the javascript file, we&#39;ve added our mapbox token in order to access the mapbox API that allows us to access the mapbox basemap that we want to use. Your final result (with your own basemap of choice) should look something like this:</p>
<p>{% include figure.html filename=&quot;webmap-08-exercise04.jpg&quot; caption=&quot;Exercise 04&quot; %}</p>
<h3 id="exercise-5-custom-marker-icon">Exercise 5: Custom Marker Icon</h3>
<p>Add a custom leaf icon, as an example you can use <a href="/assets/mapping-with-python-leaflet/exercises/exercise05/leaf.png">leaf.png</a>. Or use your own!</p>
<p>In this exercise, we only need to edit the javascript file:</p>
<pre><code class="language-javascript">window.onload = function () {

    L.mapbox.accessToken = &#39;YOURTOKENHERE&#39;;

    var basemap = L.tileLayer(&#39;https://api.mapbox.com/v4/YOURLINKHERE/{z}/{x}/{y}.png?access_token=&#39; + L.mapbox.accessToken, {
        attribution: &#39;&lt;a href=&quot;https://www.mapbox.com/tos/&quot;&gt;Mapbox&lt;/a&gt;&#39;
      });

    $.getJSON(&quot;stations.geojson&quot;, function(data) {

    var geojson = L.geoJson(data, {

//EDIT HERE
      pointToLayer: function (feature, latlng) {
       var smallIcon = L.icon({
                          iconSize: [27, 27],
                          iconAnchor: [13, 27],
                          popupAnchor:  [1, -24],
                          iconUrl: &#39;leaf.png&#39;
                  });

         return L.marker(latlng, {icon: smallIcon});
        },

      onEachFeature: function (feature, layer) {
        layer.bindPopup(feature.properties.name + &#39;&lt;p&gt;&lt;b&gt; Line: &#39; + feature.properties.line + &#39;&lt;/b&gt;&lt;/p&gt;&#39;);
      }

    });


    var map = L.map(&#39;my-map&#39;)
    .fitBounds(geojson.getBounds());
    //.setView([51.505,-0.09], 9);

    basemap.addTo(map);
    geojson.addTo(map);
  });

};
</code></pre>
<p>Marker icons are defined in leaflet using the <code>L.icon</code> object. We specify the image are using to replace our marker by using the property <code>iconUrl</code>. Make sure that you specify the proper path to your image.  We specified a few additional properties, such as iconSize (dimensions of the icon in pixels), iconAnchor (coordinates of the icon which will correspond to marker&#39;s location), popupAnchor (coordinates from which the popup should open relative to the iconAnchor). Check out the <a href="http://leafletjs.com/reference-1.2.0.html#icon">Icon Leaflet documentation</a> more information about <code>L.Icon</code> properties.</p>
<p>The final map should look something like this:</p>
<p>{% include figure.html filename=&quot;webmap-09-exercise05.jpg&quot; caption=&quot;Exercise 05&quot; %}</p>
<h2 id="next-steps">Next Steps</h2>
<p>Congratulations! You now have some hands-on experience geocoding using common Python data analysis libraries and working with one of the most popular Javascript web mapping libraries out there.</p>
<p>If you want to explore other web mapping features with Leaflet, there are a number of additional <a href="http://leafletjs.com/plugins.html">plugins</a> to try out. Of particular interest may be ability to create <a href="https://github.com/skeate/Leaflet.timeline">time based visualizations</a> and do <a href="https://github.com/pa7/heatmap.js">heat-mapping</a>.</p>
<p>Also, check out the Programming Historian Lesson <a href="/lessons/using-javascript-to-create-maps">Using Javascript to Create Maps of Correspondence</a> that goes in depth on how to analyze correspondence using geospatial software, and using some of the same tools as this lesson.</p>
<!-- HTML_TAG_END -->

<script type="application/json" data-type="svelte-data" data-url="mapping-with-python-leaflet/raw.json">{"status":200,"statusText":"","headers":{"content-type":"application/json; charset=utf-8"},"body":"{\"metadata\":{\"title\":\"Web Mapping with Python and Leaflet\",\"authors\":[\"Kim Pham\"],\"date\":\"2017-08-29T00:00:00.000Z\",\"reviewers\":[\"Shawn Graham\",\"Jim Clifford\"],\"editors\":[\"Ian Milligan\"],\"difficulty\":2,\"review-ticket\":\"https:\u002F\u002Fgithub.com\u002Fprogramminghistorian\u002Fph-submissions\u002Fissues\u002F85\",\"activity\":\"presenting\",\"topics\":[\"mapping\"],\"abstract\":\"This tutorial teaches users how to create a web map based on tabular data.\",\"layout\":\"lesson\",\"redirect_from\":\"\u002Flessons\u002Fmapping-with-python-leaflet\",\"avatar_alt\":\"Map of a mountainous terrain\",\"doi\":\"10.46430\u002Fphen0070\"},\"html_body\":\"\u003Cp\u003E{% include toc.html %}\u003C\u002Fp\u003E\\n\u003Ch1 id=\\\"lesson-goals\\\"\u003ELesson Goals\u003C\u002Fh1\u003E\\n\u003Cp\u003EIn this lesson, you will learn how to create a web map based on that data.  By the end of this lesson, you will be able to:\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003EManipulate tabular data programmatically to extract geonames and create location-based data\u003C\u002Fli\u003E\\n\u003Cli\u003EConvert tabular data into a meaningful geographic data structure\u003C\u002Fli\u003E\\n\u003Cli\u003EUnderstand and apply the basic concepts of web mapping to design your own web map\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Ch2 id=\\\"getting-started\\\"\u003EGetting Started\u003C\u002Fh2\u003E\\n\u003Ch3 id=\\\"initial-setup\\\"\u003EInitial Setup\u003C\u002Fh3\u003E\\n\u003Cp\u003EThis lesson uses:\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Ca href=\\\"\u002Flessons\u002F?topic=python\\\"\u003Epython\u003C\u002Fa\u003E (\u003Ca href=\\\"http:\u002F\u002Fpip.readthedocs.org\u002Fen\u002Fstable\u002F\\\"\u003Epip\u003C\u002Fa\u003E, \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fgeopy\u002Fgeopy\\\"\u003Egeopy\u003C\u002Fa\u003E, \u003Ca href=\\\"http:\u002F\u002Fpandas.pydata.org\u002Fpandas-docs\u002Fstable\u002Fdsintro.html#dataframe\\\"\u003Epandas\u003C\u002Fa\u003E)\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"http:\u002F\u002Fleafletjs.com\u002F\\\"\u003Eleaflet\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"http:\u002F\u002Fgeojson.io\u002F\\\"\u003Egeojson.io (from mapbox)\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fwww.javascript.com\u002F\\\"\u003Ejavascript\u003C\u002Fa\u003E and \u003Ca href=\\\"https:\u002F\u002Fjquery.com\u002F\\\"\u003Ejquery\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003EOptional: If you wish to follow along with pre-made scripts you can find them in \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fprogramminghistorian\u002Fjekyll\u002Ftree\u002Fgh-pages\u002Fassets\u002Fmapping-with-python-leaflet\\\"\u003Ethis directory\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003ETo set up your working environment:\u003C\u002Fp\u003E\\n\u003Col\u003E\\n\u003Cli\u003ECreate a directory for this project where you will keep all of your scripts and files that you will work from\u003C\u002Fli\u003E\\n\u003Cli\u003EIf you have a text editor where you can work from the directory of your project, import that directory. You can use editors such as \u003Ca href=\\\"http:\u002F\u002Fwww.barebones.com\u002Fproducts\u002Ftextwrangler\u002F\\\"\u003ETextWrangler\u003C\u002Fa\u003E for OS X, \u003Ca href=\\\"https:\u002F\u002Fnotepad-plus-plus.org\u002F\\\"\u003ENotepad++\u003C\u002Fa\u003E for Windows, or \u003Ca href=\\\"http:\u002F\u002Fwww.sublimetext.com\u002F\\\"\u003ESublime Text\u003C\u002Fa\u003E.\\nIf you are using a code editor such as Sublime Text, to import the folder you could drag and drop the folder that you want to work from into your editor window. Once you&#39;ve done that, the directory will appear on the left hand sidebar as you root folder. If you click on your folder, you&#39;ll be able to see the contents of your folder. Importing a folder allows you to easily work with the files in your project. If you need to work with multiple files and directories in directories, this will make it easier to search through these files, switch between them while you&#39;re working and keep you organized.\u003C\u002Fli\u003E\\n\u003Cli\u003E(Optional) It is recommended to use a \u003Ca href=\\\"http:\u002F\u002Fdocs.python-guide.org\u002Fen\u002Flatest\u002Fdev\u002Fvirtualenvs\u002F\\\"\u003EPython virtual environment\u003C\u002Fa\u003E to store the dependencies and versions required for your specific project.\u003C\u002Fli\u003E\\n\u003C\u002Fol\u003E\\n\u003Ch3 id=\\\"getting-data-download-the-csv\\\"\u003EGetting Data: Download the CSV\u003C\u002Fh3\u003E\\n\u003Cp\u003EWe&#39;re going to start with a plain comma-separated values (CSV) data file and create a web map from it.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ca href=\\\"\u002Fassets\u002Fmapping-with-python-leaflet\u002Fcensus.csv\\\"\u003EThe data file can be downloaded here\u003C\u002Fa\u003E. You can grab this by either opening the link in your browser and saving the page, or you can use the curl command from your command line:\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ccode\u003Ecurl -O https:\u002F\u002Fprogramminghistorian.org\u002Fassets\u002Fmapping-with-python-leaflet\u002Fcensus.csv\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EThe original source of this data is from the \u003Ca href=\\\"http:\u002F\u002Fdata.london.gov.uk\u002Fdataset\u002Fhistoric-census-population\\\"\u003EGreater London Authority London Datastore\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"geocoding-with-python\\\"\u003EGeocoding with Python\u003C\u002Fh2\u003E\\n\u003Ch3 id=\\\"geocode-the-placenames-in-the-csv-using-geopy-pandas\\\"\u003EGeocode the placenames in the CSV using Geopy, Pandas\u003C\u002Fh3\u003E\\n\u003Cp\u003ENow that we have data, we will use this as our source to make a web map. Web maps typically represent locations and features from geographic data formats such as geoJSON and KML. Every location in a geographic data file can be considered to have geometry (such as points, lines, polygons) as well as additional properties. Web maps typically understand locations as a series of coordinates. For example, 43.6426,-79.3871 would represent the exact coordinates of the \u003Ca href=\\\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FCN_Tower\\\"\u003ECN Tower in Toronto\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003EIn our data file, we have a list of placenames in our CSV data (the Area Name column), but no coordinates. What we want to do then is to somehow generate coordinates from these locations. This process is called geocoding.\u003C\u002Fp\u003E\\n\u003Cp\u003ESo here is our first problem to solve:  how can we geocode placenames? How could we take an entry such as &quot;CN Tower&quot; and add the coordinates 43.6426,-79.3871 to it automatically?\u003C\u002Fp\u003E\\n\u003Cp\u003ETo clarify, we need to figure out how to gather coordinates for a location for each row of a CSV file in order to display these locations on a web map.\u003C\u002Fp\u003E\\n\u003Cp\u003EThere&#39;s a simple way to do this: you can look up a coordinate online in Google Maps and put each coordinate in your spreadsheet manually.  But, if you had 5,000 points the task becomes a little bit more daunting. If you&#39;re faced with a repetitive task, it might be worthwhile to approach it programmatically.\u003C\u002Fp\u003E\\n\u003Cp\u003EIf you&#39;re familiar with \u003Cem\u003EProgramming Historian\u003C\u002Fem\u003E, you might have already noticed that there are many \u003Ca href=\\\"\u002Flessons\u002F?topic=python\\\"\u003Elessons available on how to use Python\u003C\u002Fa\u003E.  Python is a great beginner programming language because it is easy to read and happens to be used a lot in GIS applications to optimize workflows.  One of the biggest advantages to Python is the impressive amount of libraries which act like pluggable tools to use for many different tasks.  Knowing that this is a good programmatic approach, we&#39;re now going to build a Python script that will automate geocode every address for us.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fgeopy\u002Fgeopy\\\"\u003EGeopy\u003C\u002Fa\u003E is a Python library that gives you access to the various geocoding APIs.  Geopy makes it easy for Python developers to locate the coordinates of addresses, cities, countries, and landmarks across the globe using third-party geocoders and other data sources. Geopy includes geocoders built by OpenStreetMap Nominatim, ESRI ArcGIS, Google Geocoding API (V3), Baidu Maps, Bing Maps API, Yahoo! PlaceFinder, Yandex, IGN France, GeoNames, NaviData, OpenMapQuest, What3Words, OpenCage, SmartyStreets, geocoder.us, and GeocodeFarm geocoder services.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ca href=\\\"http:\u002F\u002Fpandas.pydata.org\u002Fpandas-docs\u002Fstable\u002Fdsintro.html#dataframe\\\"\u003EPandas\u003C\u002Fa\u003E is another python library that we will use.  It&#39;s very popular library amongst scientists and mathematicians to manipulate and analyse data.\u003C\u002Fp\u003E\\n\u003Cp\u003EFinally, \u003Ca href=\\\"http:\u002F\u002Fpip.readthedocs.org\u002Fen\u002Fstable\u002F\\\"\u003EPip\u003C\u002Fa\u003E is a very useful package manager to help you install things like Geopy and Pandas! If you&#39;ve \u003Ca href=\\\"\u002Flessons\u002Fintroduction-and-installation\\\"\u003Ealready installed Python\u003C\u002Fa\u003E and \u003Ca href=\\\"\u002Flessons\u002Finstalling-python-modules-pip\\\"\u003Einstalled pip\u003C\u002Fa\u003E, type \u003Ccode\u003Epip list\u003C\u002Fcode\u003E to see if you already have the geopy and pandas packages installed. If you do not have pip installed, you can download \u003Ca href=\\\"https:\u002F\u002Fbootstrap.pypa.io\u002Fget-pip.py\\\"\u003Eget-pip.py\u003C\u002Fa\u003E, then from your command line go to the directory where get-pip.py is located and run\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ccode\u003Epython get-pip.py \u003C\u002Fcode\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EFor the most up to date instructions, you can visit \u003Ca href=\\\"http:\u002F\u002Fpip.readthedocs.org\u002Fen\u002Fstable\u002Finstalling\u002F\\\"\u003Epip&#39;s installation manual\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003ETo install Geopy and Pandas, open your \u003Ca href=\\\"\u002Flessons\u002Fintro-to-bash\\\"\u003Ecommand line (using this lesson as a guideline if necessary)\u003C\u002Fa\u003E and install the Geopy and Pandas libraries:\u003C\u002Fp\u003E\\n\u003Cp\u003EOn OS X or Linux, the following commands will install the necessary packages:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-bash\\\"\u003Epip install numpy\\npip install python-dateutil\\npip install pytz\\npip install geopy\\npip install pandas\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003ENote: We are installing numpy, python-dateutil, and pytz because pandas \u003Ca href=\\\"http:\u002F\u002Fpandas.pydata.org\u002Fpandas-docs\u002Fstable\u002Finstall.html#dependencies\\\"\u003Erequires them\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003EFor Windows, you may need to install \u003Ca href=\\\"https:\u002F\u002Fwiki.python.org\u002Fmoin\u002FWindowsCompilers\\\"\u003EMicrosoft Visual C++ Compiler for Python\u003C\u002Fa\u003E. Set the environmental variables to recognize python and pip from the command line:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode\u003Esetx  PATH &quot;%PATH%;C:\\\\Python27&quot;\\nsetx  PATH &quot;%PATH%;C:\\\\Python27\\\\Scripts&quot;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EIf you keep getting an error when you&#39;re trying to install these libraries, you may need to use \u003Ccode\u003Esudo pip install\u003C\u002Fcode\u003E instead of just \u003Ccode\u003Epip install\u003C\u002Fcode\u003E. You may also need to upgrade your libraries if you&#39;ve installed them earlier and you find that you&#39;re encountering an error when using Python (i.e. an ImportError). In order to do so, the following command works:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-bash\\\"\u003Epip install python --upgrade\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003ERepeat for the other dependencies listed above.\u003C\u002Fp\u003E\\n\u003Cp\u003ENow we&#39;re going to start building our script. We&#39;re going to go through the script, line by line, and then run it through the command line at the end. To get started, open your text editor and save your blank document as a python script (name it \u003Ccode\u003Egeocoder.py\u003C\u002Fcode\u003E).  For the first part of your Python script, you will want to import your libraries and your data:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-python\\\"\u003Eimport geopy\\nimport pandas\\nfrom geopy.geocoders import Nominatim\\n# versions used: geopy 2.2.0, pandas 1.3.3, python 3.7.5\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EIn the code above, we are importing the different Python libraries that we will need to use later on in our script.  We import geopy, specifically the geopy.geocoders that we will call on later which is \u003Ca href=\\\"https:\u002F\u002Fwiki.openstreetmap.org\u002Fwiki\u002FNominatim\\\"\u003ENominatim\u003C\u002Fa\u003E and \u003Ca href=\\\"https:\u002F\u002Fdevelopers.google.com\u002Fmaps\u002Fdocumentation\u002Fgeocoding\u002Fstart\\\"\u003EGoogle Maps V3 API\u003C\u002Fa\u003E, and we import pandas.\u003C\u002Fp\u003E\\n\u003Cp\u003EThen you want to create a function main() that reads your input CSV.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-python\\\"\u003Eimport geopy\\nimport pandas\\nfrom geopy.geocoders import Nominatim\\n# versions used: geopy 2.2.0, pandas 1.3.3, python 3.7.5\\n\\ndef main():\\n    io = pandas.read_csv(&#39;census-historic-population-borough.csv&#39;, index_col=None, header=0, sep=&quot;,&quot;)\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EWe are first using pandas&#39; pre-existing read_csv() function to open the CSV file. We pass the filepath to our data file in the first parameter, &#39;census-historic-population-borough.csv&#39;. If it was in a folder called &#39;data&#39;, you would put &#39;data\u002Fcensus-historic-population-borough.csv&#39;.  The second parameter, \u003Ccode\u003Eindex_col=None\u003C\u002Fcode\u003E, will number the rows to generate the index without using any column.  If we use \u003Ccode\u003Eindex_col=0\u003C\u002Fcode\u003E, it indexes the first column in your data as the row name. The third parameter, \u003Ccode\u003Eheader=0\u003C\u002Fcode\u003E, indicates that there is a header row, which is the first line of the spreadsheet (Note: Python uses &quot;0&quot; instead of &quot;1&quot; to indicate the first value in an index). The fourth parameter \u003Ccode\u003Esep=&quot;,&quot;\u003C\u002Fcode\u003E is where you indicate delimiter symbol that is used to split data into fields.  Since are using a comma separated values data format, we need to indicate that we are using a comma to split our data.\u003C\u002Fp\u003E\\n\u003Cp\u003EThere are many other parameters you can use.  A full list is available in the pandas documentation on the \u003Ca href=\\\"http:\u002F\u002Fpandas.pydata.org\u002Fpandas-docs\u002Fstable\u002Fgenerated\u002Fpandas.read_csv.html\\\"\u003Eread_csv() function\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003ENext, we anticipate that when we geocode the csv we will get points in the format of (latitude, longitude). If we only want the latitude value of the point in a csv column, we will define a function to isolate that value. The same can be done for our longitude value.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-python\\\"\u003Eimport geopy\\nimport pandas\\n# versions used: geopy 2.2.0, pandas 1.3.3, python 3.7.5\\n\\ndef main():\\n  io = pandas.read_csv(&#39;census-historic-population-borough.csv&#39;, index_col=None, header=0, sep=&quot;,&quot;)\\n\\ndef get_latitude(x):\\n  return x.latitude\\n\\ndef get_longitude(x):\\n  return x.longitude\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003ENext, select the geolocator you want to use.  Here we&#39;re creating two geolocators: Open Street Map&#39;s Nominatim and Google&#39;s Geocoding API.  Here&#39;s a quick comparison:\u003C\u002Fp\u003E\\n\u003Ctable\u003E\\n\u003Cthead\u003E\\n\u003Ctr\u003E\\n\u003Cth\u003EGeolocator\u003C\u002Fth\u003E\\n\u003Cth\u003ENominatim()\u003C\u002Fth\u003E\\n\u003C\u002Ftr\u003E\\n\u003C\u002Fthead\u003E\\n\u003Ctbody\u003E\u003Ctr\u003E\\n\u003Ctd\u003Eaffiliation\u003C\u002Ftd\u003E\\n\u003Ctd\u003EOpenStreetMap\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\\n\u003Ctd\u003Eapplication use\u003C\u002Ftd\u003E\\n\u003Ctd\u003Esingle-threaded applications, can only run geolocator one process at a time\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\\n\u003Ctd\u003Ecapabilities for app development\u003C\u002Ftd\u003E\\n\u003Ctd\u003Ecan geocode based on user-input\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\\n\u003Ctd\u003Erequest limit\u003C\u002Ftd\u003E\\n\u003Ctd\u003E1 request\u002Fs or timeout\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\\n\u003Ctd\u003Eperformance test on census data\u003C\u002Ftd\u003E\\n\u003Ctd\u003E33.5s\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\\n\u003Cp\u003EYou can also choose a different geolocator from the list found in \u003Ca href=\\\"http:\u002F\u002Fgeopy.readthedocs.org\u002F\\\"\u003Ethe geopy documentation\u003C\u002Fa\u003E. GoogleV3 is a geocoder compatible with geopy, it is a reliable geolocator choice because of their large geographic data coverage. However, since July 2018 an API key is required, and you need to enable billing in Google Cloud to use it. For more information about choosing geolocators, you can follow the discussion in the \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fgeopy\u002Fgeopy\u002Fissues\u002F90\\\"\u003Egeopy repository on Github\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003ETo use a geolocator, import them and assign a variable name (in this case we use the name geolocator):\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-python\\\"\u003Eimport geopy\\nimport pandas\\nfrom geopy.geocoders import Nominatim\\n# versions used: geopy 2.2.0, pandas 1.3.3, python 3.7.5\\n\\ndef main():\\n  io = pandas.read_csv(&#39;census-historic-population-borough.csv&#39;, index_col=None, header=0, sep=&quot;,&quot;)\\n\\n  def get_latitude(x):\\n    return x.latitude\\n\\n  def get_longitude(x):\\n    return x.longitude\\n\\ngeolocator = Nominatim()\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EFinally, using pandas you want to create a column in your spreadsheet called &#39;latitude&#39;.  The script will read the existing &#39;Area_Name&#39; data column, run the geopy \u003Ca href=\\\"http:\u002F\u002Fgeopy.readthedocs.io\u002Fen\u002Flatest\u002F#module-geopy.geocoders\\\"\u003Egeolocator\u003C\u002Fa\u003E on the column using pandas&#39; \u003Ca href=\\\"http:\u002F\u002Fpandas.pydata.org\u002Fpandas-docs\u002Fstable\u002Fgenerated\u002Fpandas.DataFrame.apply.html\\\"\u003Eapply function\u003C\u002Fa\u003E, and generate a latitude coordinate in that column.  The same transformation will occur in the &#39;longitude&#39; column.  Once this is finished it will output a new CSV file with those two columns:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-python\\\"\u003Eimport geopy\\nimport pandas\\nfrom geopy.geocoders import Nominatim\\n# versions used: geopy 2.2.0, pandas 1.3.3, python 3.7.5\\n\\ndef main():\\n  io = pandas.read_csv(&#39;census-historic-population-borough.csv&#39;, index_col=None, header=0, sep=&quot;,&quot;)\\n\\n  def get_latitude(x):\\n    return x.latitude\\n\\n  def get_longitude(x):\\n    return x.longitude\\n\\n  geolocator = Nominatim()\\n\\n  geolocate_column = io[&#39;Area_Name&#39;].apply(geolocator.geocode)\\n  io[&#39;latitude&#39;] = geolocate_column.apply(get_latitude)\\n  io[&#39;longitude&#39;] = geolocate_column.apply(get_longitude)\\n  io.to_csv(&#39;geocoding-output.csv&#39;)\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EIf we didn&#39;t have the \u003Ccode\u003E.apply(get_latitude)\u003C\u002Fcode\u003E part of the code, we&#39;d get the full point data. For instance, if we were again geocoding the CN Tower and used just \u003Ccode\u003E.apply(geolocator.geocode)\u003C\u002Fcode\u003E, we would get 43.6426,-79.3871 in our column. Adding the additional \u003Ccode\u003E.apply(get_latitude)\u003C\u002Fcode\u003E would mean that we&#39;d only get 43.6426 in our column.\u003C\u002Fp\u003E\\n\u003Cp\u003ETo finish off your code, it&#39;s good practice to make your python modular, that way you can plug it in and out of other applications (should you want to use this script as part of another program). This is what your final python script should look like:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-python\\\"\u003Eimport geopy\\nimport pandas\\nfrom geopy.geocoders import Nominatim\\n# versions used: geopy 2.2.0, pandas 1.3.3, python 3.7.5\\n\\ndef main():\\n  io = pandas.read_csv(&#39;census-historic-population-borough.csv&#39;, index_col=None, header=0, sep=&quot;,&quot;)\\n\\n  def get_latitude(x):\\n    return x.latitude\\n\\n  def get_longitude(x):\\n    return x.longitude\\n\\n  geolocator = Nominatim(user_agent=&quot;email@email.com&quot;)\\n\\n  geolocate_column = io[&#39;Area_Name&#39;].apply(geolocator.geocode)\\n  io[&#39;latitude&#39;] = geolocate_column.apply(get_latitude)\\n  io[&#39;longitude&#39;] = geolocate_column.apply(get_longitude)\\n  io.to_csv(&#39;geocoding-output.csv&#39;)\\n\\nif __name__ == &#39;__main__&#39;:\\n  main()\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EDo you have the script saved and ready to go? Good.  Run the script from your command line by typing:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-bash\\\"\u003Epython geocoder.py\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EIt takes a few seconds and may take longer depending on the geolocator you use. Once the script finishes running, you should have coordinates for every Area_Name.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003ETip 1: If you want to pass the filenames from the command line rather than changing the input file name in the python script everytime, you can import the python &#39;sys&#39; library to pass through arguments. Your code might look like this:\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-python\\\"\u003Eimport geopy, sys\\nimport pandas\\nfrom geopy.geocoders import Nominatim\\n# versions used: geopy 2.2.0, pandas 1.3.3, python 3.7.5\\n\\ninputfile=str(sys.argv[1])\\nnamecolumn=str(sys.argv[2])\\n\\ndef main():\\n  io = pandas.read_csv(inputfile, index_col=None, header=0, sep=&quot;,&quot;)\\n\\ndef get_latitude(x):\\n  return x.latitude\\n\\n  def get_longitude(x):\\n    return x.longitude\\n\\n  geolocator = Nominatim()\\n\\n  geolocate_column = io[namecolumn].apply(geolocator.geocode)\\n  io[&#39;latitude&#39;] = geolocate_column.apply(get_latitude)\\n  io[&#39;longitude&#39;] = geolocate_column.apply(get_longitude)\\n  io.to_csv(&#39;geocoding-output.csv&#39;)\\n\\nif __name__ == &#39;__main__&#39;:\\n  main()\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003ETo run your python script your command would look like this:\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ccode\u003Epython geocoder.py census-historic-population-borough.csv Area_Name\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003ETip 2:\\nIf you run geocoder.py too many times you might get a timeout error.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EThe error will look like this if you use the Nominatim geocoder:\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ccode\u003Egeopy.exc.GeocoderTimedOut: Service timed out\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003ETo address the timeout error, you could add the parameter \u003Ccode\u003Etimeout\u003C\u002Fcode\u003E, which specifies the time, in seconds, to wait for the geocoding service to respond before raising a geopy.exc.GeocoderTimedOut exception. So your geolocator declaration will look like this:\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ccode\u003Egeolocator = Nominatim(user_agent=&quot;email@email.com&quot;, timeout=5)\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"transforming-data-with-python\\\"\u003ETransforming Data with Python\u003C\u002Fh2\u003E\\n\u003Ch3 id=\\\"making-geojson\\\"\u003EMaking GeoJSON\u003C\u002Fh3\u003E\\n\u003Cp\u003ENow that you have a spreadsheet full of coordinate data, we can convert the CSV spreadsheet into a format that web maps like, like GeoJSON.  GeoJSON is a web mapping standard of JSON data.  There are a couple of ways to make GeoJSON:\u003C\u002Fp\u003E\\n\u003Cp\u003EThe easiest, recommended way is to use a UI tool developed by Mapbox called \u003Ca href=\\\"http:\u002F\u002Fgeojson.io\\\"\u003Egeojson.io\u003C\u002Fa\u003E.  All you have to do is click and drag your csv file into the data window (the right side of the screen, next to the map), and it will automatically format your data into GeoJSON for you. You can select the &#39;GeoJSON&#39; option under &#39;Save.&#39;  Save your GeoJSON file as \u003Ccode\u003Ecensus.geojson\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;webmap-01-geojsonio.gif&quot; caption=&quot;Drag and Drop GeoJSON creation!&quot; %}\u003C\u002Fp\u003E\\n\u003Cp\u003EImage Credit: with permission from Mauricio Giraldo Arteaga, NYPL Labs\u003C\u002Fp\u003E\\n\u003Cp\u003EYou can also do it from the command line, using the \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fmapbox\u002Fcsv2geojson\\\"\u003Ecsv2geojson library\u003C\u002Fa\u003E that powers geojson.io.\u003C\u002Fp\u003E\\n\u003Cp\u003ETest this data out by importing it again into geojson.io.  You should see points generated in the preview window.  That&#39;s your data!\u003C\u002Fp\u003E\\n\u003Ch3 id=\\\"you-finally-have-geojson-but-you-need-to-do-some-cleaning\\\"\u003EYou finally have GeoJSON... but you need to do some cleaning!\u003C\u002Fh3\u003E\\n\u003Cp\u003EIf you&#39;ve tested your GeoJSON data, you might notice that not every point is geolocated correctly.  We know that every Area_Name is a borough of London, but points appear all over United Kingdom, and some aren&#39;t located even in the country.\u003C\u002Fp\u003E\\n\u003Cp\u003ETo make the results more accurate, save another copy of the census-historic-population-borough.csv file, calling it census_country.csv and include an additional column called &#39;Country&#39; and put &#39;United Kingdom&#39; in every row of your data. For even greater accuracy add &#39;City&#39; and put &#39;London&#39; in every row of your data to provide additional context for your data.\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;webmap-02-countrycolumn.png&quot; caption=&quot;A new Country column&quot; %}\u003C\u002Fp\u003E\\n\u003Cp\u003EMake a copy of your geocoder.py python script, calling it geocoder-helpercolumn.py. Remove the following lines:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-python\\\"\u003E  geolocate_column = io[namecolumn].apply(geolocator.geocode)\\n  io[&#39;latitude&#39;] = geolocate_column.apply(get_latitude)\\n  io[&#39;longitude&#39;] = geolocate_column.apply(get_longitude)\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003E and replacing it with the following that combines the Area_Name and Country or City column to geocode your data:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-python\\\"\u003E  io[&#39;helper&#39;] = io[&#39;Area_Name&#39;].map(str) + &quot; &quot; + io[&#39;Country&#39;].map(str)\\n  geolocate_column = io[&#39;helper&#39;].apply(geolocator.geocode)\\n  io[&#39;latitude&#39;] = geolocate_column.apply(get_latitude)\\n  io[&#39;longitude&#39;] = geolocate_column.apply(get_longitude)\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003ENote that we added the .map(str) function. This is a pandas function that is allowing you to concatenate two DataFrame columns into a new, single column (helper) using the syntax format:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-python\\\"\u003Edf[&#39;newcol&#39;] = df[&#39;col1&#39;].map(str) + df[&#39;col2&#39;].map(str)\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EYou will also want to comment out and commenting out \u003Ccode\u003Enamecolumn=str(sys.argv[2])\u003C\u002Fcode\u003E since we are now directly specifying the column that we are using in the script.\u003C\u002Fp\u003E\\n\u003Cp\u003EYour final script should look like this:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-python\\\"\u003Eimport geopy, sys\\nimport pandas\\nfrom geopy.geocoders import Nominatim\\n\\ninputfile=str(sys.argv[1])\\n# namecolumn=str(sys.argv[2])\\n\\ndef main():\\n  io = pandas.read_csv(inputfile, index_col=None, header=0, sep=&quot;,&quot;)\\n\\n  def get_latitude(x):\\n    return x.latitude\\n\\n  def get_longitude(x):\\n    return x.longitude\\n\\n  # geolocator = Nominatim(timeout=5)\\n  # uncomment the geolocator you want to use\\n  # change the timeout value if you get a timeout error, for instance, geolocator = Nominatim(timeout=60)\\n  io[&#39;helper&#39;] = io[&#39;Area_Name&#39;].map(str) + &quot; &quot; + io[&#39;Country&#39;].map(str)\\n  geolocate_column = io[&#39;helper&#39;].apply(geolocator.geocode)\\n  io[&#39;latitude&#39;] = geolocate_column.apply(get_latitude)\\n  io[&#39;longitude&#39;] = geolocate_column.apply(get_longitude)\\n  io.to_csv(&#39;geocoding-output-helper.csv&#39;)\\n\\nif __name__ == &#39;__main__&#39;:\\n  main()\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EWhich you can now run by using the command:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode\u003Epython geocoder-helpercolumn.py census_country.csv\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003ETurn your clean data into GeoJSON by saving it as \u003Ccode\u003Ecensus.geojson\u003C\u002Fcode\u003E and test it out at \u003Ca href=\\\"http:\u002F\u002Fgeojson.io\\\"\u003Egeojson.io\u003C\u002Fa\u003E. Remember, drag the new CSV you created (\u003Ccode\u003Ecensus_country.csv\u003C\u002Fcode\u003E into the window to create that beautiful JSON). Do the results look better now? Good!\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"using-leaflet-to-create-a-web-map\\\"\u003EUsing Leaflet to Create a Web Map\u003C\u002Fh2\u003E\\n\u003Ch3 id=\\\"i-now-have-clean-geojson-data--lets-make-a-map\\\"\u003EI now have clean GeoJSON data.  Lets make a map!\u003C\u002Fh3\u003E\\n\u003Cp\u003ESetup a test web server to test out our maps. A web server is used to serve content from your directory to your browser.\u003C\u002Fp\u003E\\n\u003Cp\u003E If you&#39;re in your working directory, from the command line, run:\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ccode\u003Epython -m SimpleHTTPServer\u003C\u002Fcode\u003E or \u003Ccode\u003Epython3 -m http.server\u003C\u002Fcode\u003E (for Python3)\u003C\u002Fp\u003E\\n\u003Cp\u003ESimpleHTTPServer is a Python module. If you want to change the server to port 8080 (or any other port), use\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ccode\u003Epython -m SimpleHTTPServer 8080\u003C\u002Fcode\u003E or \u003Ccode\u003Epython3 -m http.server 8080\u003C\u002Fcode\u003E (for Python3)\u003C\u002Fp\u003E\\n\u003Cp\u003EIn your browser go to \u003Ca href=\\\"http:\u002F\u002Flocalhost:8080\\\"\u003Ehttp:\u002F\u002Flocalhost:8080\u003C\u002Fa\u003E and you should see the files you&#39;ve been working with so far.\u003C\u002Fp\u003E\\n\u003Cp\u003ENow in your text editor open a new document and save it as an html file (mymap.html).  If you want to do a quick test, copy and paste the text below, refresh your \u003Ca href=\\\"http:\u002F\u002Flocalhost:8080\\\"\u003Ehttp:\u002F\u002Flocalhost:8080\u003C\u002Fa\u003E and open the html file in your browser.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-html\\\"\u003E&lt;!DOCTYPE html&gt;\\n&lt;head&gt;\\n&lt;link rel=&quot;stylesheet&quot; href=&quot;http:\u002F\u002Fcdn.leafletjs.com\u002Fleaflet-0.6.4\u002Fleaflet.css&quot; \u002F&gt;\\n&lt;script src=&quot;http:\u002F\u002Fcdn.leafletjs.com\u002Fleaflet-0.6.4\u002Fleaflet.js&quot;&gt;&lt;\u002Fscript&gt;\\n&lt;script src=&quot;https:\u002F\u002Fcode.jquery.com\u002Fjquery-2.1.4.min.js&quot;&gt;&lt;\u002Fscript&gt;\\n\\n\\n&lt;style&gt;\\n#my-map {\\n    width:960px;\\n    height:500px;\\n}\\n&lt;\u002Fstyle&gt;\\n&lt;\u002Fhead&gt;\\n\\n&lt;body&gt;\\n    &lt;div id=&quot;my-map&quot;&gt;&lt;\u002Fdiv&gt;\\n&lt;script&gt;\\nwindow.onload = function () {\\n    var basemap = L.tileLayer(&#39;http:\u002F\u002F{s}.tile.osm.org\u002F{z}\u002F{x}\u002F{y}.png&#39;, {\\n        attribution: &#39;&amp;copy; &lt;a href=&quot;http:\u002F\u002Fosm.org\u002Fcopyright&quot;&gt;OpenStreetMap&lt;\u002Fa&gt; contributors&#39;\\n    });\\n\\n    $.getJSON(&quot;census.geojson&quot;, function(data) {\\n\\n    var geojson = L.geoJson(data, {\\n      onEachFeature: function (feature, layer) {\\n        layer.bindPopup(feature.properties.Area_Name);\\n      }\\n    });\\n\\n    var map = L.map(&#39;my-map&#39;)\\n    .fitBounds(geojson.getBounds());\\n\u002F\u002F    .setView([0.0,-10.0], 2);\\n\\n    basemap.addTo(map);\\n    geojson.addTo(map);\\n  });\\n\\n};\\n&lt;\u002Fscript&gt;\\n&lt;\u002Fbody&gt;\\n&lt;\u002Fhtml&gt;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EDo you see a map now?  Good! If not, you can troubleshoot by inspecting the browser, or by going back and retracing your steps.\u003C\u002Fp\u003E\\n\u003Ch3 id=\\\"what-did-i-just-make\\\"\u003EWhat did I just make?\u003C\u002Fh3\u003E\\n\u003Cp\u003EYou made a web map!  Web maps use map tiles, which are pixel based images (rasters) of maps that contain geographical data. This means that each pixel of a map tile has been georeferenced, or assigned a coordinate based on the location that they represent.  When you zoom in and out of a web map, you are getting a whole new set of tiles to display at each zoom level. GeoJSON (which you are now familiar with) is a widely used data standard for web mapping.  In our example, we are using an open-source Javascript library called \u003Ca href=\\\"http:\u002F\u002Fleafletjs.com\u002Freference.html\\\"\u003ELeaflet\u003C\u002Fa\u003E to help us build our web map. The benefits of using an open-source library such as Leaflet is the flexibility you get and with developing and customizing your map, without worry of the technology being deprecated or no longer supported that is beyond your control.  With frameworks like Leaflet or Google Maps Javascript API, you&#39;re not building a map completely from scratch, rather, you&#39;re using pre-written functions and controls that helps you customize your own map in code.\u003C\u002Fp\u003E\\n\u003Cp\u003ELets go through what each part of the code is doing. But first, it&#39;s best practice to maintain your html, css, js in different files so that the web map&#39;s content, presentation and behaviour layers are kept separate (though it&#39;s not always possible). This adds a bit more structure to your code, making it easier for you and others to understand. It will be easier to focus on certain parts of the code when you&#39;re going back and making changes. So here is our code split into three files:\u003C\u002Fp\u003E\\n\u003Cp\u003Emymap.html\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-html\\\"\u003E&lt;!DOCTYPE html&gt;\\n&lt;head&gt;\\n&lt;link rel=&quot;stylesheet&quot; href=&quot;http:\u002F\u002Fcdn.leafletjs.com\u002Fleaflet-0.6.4\u002Fleaflet.css&quot; \u002F&gt;\\n&lt;script src=&quot;http:\u002F\u002Fcdn.leafletjs.com\u002Fleaflet-0.6.4\u002Fleaflet.js&quot;&gt;&lt;\u002Fscript&gt;\\n&lt;script src=&quot;https:\u002F\u002Fcode.jquery.com\u002Fjquery-2.1.4.min.js&quot;&gt;&lt;\u002Fscript&gt;\\n&lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot; \u002F&gt;\\n&lt;\u002Fhead&gt;\\n\\n&lt;body&gt;\\n    &lt;div id=&quot;my-map&quot;&gt;&lt;\u002Fdiv&gt;\\n&lt;\u002Fbody&gt;\\n&lt;script src=&#39;leafletmap.js&#39;&gt;&lt;\u002Fscript&gt;\\n\\n&lt;\u002Fhtml&gt;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003Estyle.css\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-css\\\"\u003E#my-map {\\n    width:960px;\\n    height:500px;\\n}\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003Eleafletmap.js\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-javascript\\\"\u003Ewindow.onload = function () {\\n    var basemap = L.tileLayer(&#39;http:\u002F\u002F{s}.tile.osm.org\u002F{z}\u002F{x}\u002F{y}.png&#39;, {\\n        attribution: &#39;&amp;copy; &lt;a href=&quot;http:\u002F\u002Fosm.org\u002Fcopyright&quot;&gt;OpenStreetMap&lt;\u002Fa&gt; contributors&#39;\\n    });\\n\\n    $.getJSON(&quot;census.geojson&quot;, function(data) {\\n\\n    var geojson = L.geoJson(data, {\\n      onEachFeature: function (feature, layer) {\\n        layer.bindPopup(feature.properties.Area_Name);\\n      }\\n    });\\n\\n\\n    var map = L.map(&#39;my-map&#39;)\\n    .fitBounds(geojson.getBounds());\\n\\n    basemap.addTo(map);\\n    geojson.addTo(map);\\n  });\\n\\n};\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003ESeems a bit easier to undestand now, doesn&#39;t it? Now lets look at what the html file is doing.\u003C\u002Fp\u003E\\n\u003Ch4 id=\\\"mymaphtml-walkthrough\\\"\u003Emymap.html walkthrough\u003C\u002Fh4\u003E\\n\u003Cp\u003Emymap.html\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-html\\\"\u003E&lt;!DOCTYPE html&gt;\\n&lt;head&gt;\\n&lt;link rel=&quot;stylesheet&quot; href=&quot;http:\u002F\u002Fcdn.leafletjs.com\u002Fleaflet-0.6.4\u002Fleaflet.css&quot; \u002F&gt;\\n&lt;script src=&quot;http:\u002F\u002Fcdn.leafletjs.com\u002Fleaflet-0.6.4\u002Fleaflet.js&quot;&gt;&lt;\u002Fscript&gt;\\n&lt;script src=&quot;https:\u002F\u002Fcode.jquery.com\u002Fjquery-2.1.4.min.js&quot;&gt;&lt;\u002Fscript&gt;\\n&lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot; \u002F&gt;\\n&lt;\u002Fhead&gt;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe above code is the first section, or header of your html document. We are linking to the external javascript library and css stylesheets provided by leaflet.  We&#39;re also linking to our own stylesheet, style.css.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-html\\\"\u003E\\n&lt;body&gt;\\n    &lt;div id=&quot;my-map&quot;&gt;&lt;\u002Fdiv&gt;\\n&lt;\u002Fbody&gt;\\n&lt;script src=&#39;leafletmap.js&#39;&gt;&lt;\u002Fscript&gt;\\n\\n&lt;\u002Fhtml&gt;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003ENext, we&#39;re declaring the body and where you want the map to go on your page. We&#39;re also linking to our own javascript file, leafletmap.js.\u003C\u002Fp\u003E\\n\u003Ch4 id=\\\"stylecss-walkthrough\\\"\u003Estyle.css walkthrough\u003C\u002Fh4\u003E\\n\u003Cp\u003Estyle.css\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-css\\\"\u003E#my-map {\\n    width:960px;\\n    height:500px;\\n}\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThere&#39;s a bit of CSS styling here to specify the size of your map. Some optional styling will happen in your javascript file if you&#39;re using the Leaflet library.\u003C\u002Fp\u003E\\n\u003Ch4 id=\\\"leafletmapjs-walkthrough\\\"\u003Eleafletmap.js walkthrough\u003C\u002Fh4\u003E\\n\u003Cp\u003Eleafletmap.js\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-javascript\\\"\u003Ewindow.onload = function () {\\n    var basemap = L.tileLayer(&#39;http:\u002F\u002F{s}.tile.osm.org\u002F{z}\u002F{x}\u002F{y}.png&#39;, {\\n        attribution: &#39;&amp;copy; &lt;a href=&quot;http:\u002F\u002Fosm.org\u002Fcopyright&quot;&gt;OpenStreetMap&lt;\u002Fa&gt; contributors&#39;\\n    });\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe javascript file is what provides the behaviour, or functionality of our web map. It&#39;s what makes our web map come alive! In the code above, we&#39;re telling the javascript to load when the browser loads. We&#39;re creating our first map layer, which is your basemap.  The basemap is the tiles provided by OpenStreetMap that provides places and streetnames found on maps.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-javascript\\\"\u003E    $.getJSON(&quot;census.geojson&quot;, function(data) {\\n\\n    var geojson = L.geoJson(data, {\\n      onEachFeature: function (feature, layer) {\\n        layer.bindPopup(feature.properties.Area_Name);\\n      }\\n    });\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003ENext, we&#39;re loading our data as another map layer, \u003Ccode\u003Ecensus.geojson\u003C\u002Fcode\u003E.  This data will have additional properties: each point of data is represented by an icon. It will look and behave like a popup so that when you click on the icon it will load information from your data file (in this case, the Area_Name).\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-javascript\\\"\u003E   var map = L.map(&#39;my-map&#39;)\\n    .fitBounds(geojson.getBounds());\\n\\n    basemap.addTo(map);\\n    geojson.addTo(map);\\n  });\\n\\n};\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003ENow we&#39;re creating the view for our map.  The boundary for our map will be based on the range of our data points in \u003Ccode\u003Ecensus.geojson\u003C\u002Fcode\u003E.  You can also manually set your your viewport by using the \u003Ca href=\\\"http:\u002F\u002Fleafletjs.com\u002Freference.html#map-set-methods\\\"\u003EsetView property\u003C\u002Fa\u003E. For example, if you&#39;re using \u003Ccode\u003E.setView([0.0,-10.0], 2)\u003C\u002Fcode\u003E , the viewport coordinates &#39;[0.0,-10.0], 2&#39; means that you&#39;re setting the centre of the map to be 0.0, -10.0 and at a zoom level of 2.\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;webmap-03-result.jpg&quot; caption=&quot;My Web Map&quot; %}\u003C\u002Fp\u003E\\n\u003Cp\u003EFinally, the map layers you created will be added to your map. Put it all together and hurrah, you&#39;ve got your web map!  Now lets play around with it. The following five exercises give you tasks to do to learn some of the other elements, with answers provided.\u003C\u002Fp\u003E\\n\u003Ch3 id=\\\"exercise-1-default-viewports\\\"\u003EExercise 1: Default Viewports\u003C\u002Fh3\u003E\\n\u003Cp\u003ELet&#39;s change the map to use a viewport to 51.505 latitude, -0.09 longitude with a zoom level 9. To do this, we just need to edit one file: \u003Ccode\u003Eleafletmap.js\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-javascript\\\"\u003Ewindow.onload = function () {\\n    var basemap = L.tileLayer(&#39;http:\u002F\u002F{s}.tile.osm.org\u002F{z}\u002F{x}\u002F{y}.png&#39;, {\\n    attribution: &#39;&amp;copy; &lt;a href=&quot;http:\u002F\u002Fosm.org\u002Fcopyright&quot;&gt;OpenStreetMap&lt;\u002Fa&gt; contributors&#39;\\n  });\\n\\n    $.getJSON(&quot;census.geojson&quot;, function(data) {\\n\\n    var geojson = L.geoJson(data, {\\n      onEachFeature: function (feature, layer) {\\n        layer.bindPopup(feature.properties.Area_Name);\\n      }\\n    });\\n\\n\\n    var map = L.map(&#39;my-map&#39;)\\n    \u002F\u002F.fitBounds(geojson.getBounds());\\n    .setView([51.505,-0.09], 9);\\n    \u002F\u002FEDIT HERE\\n\\n    basemap.addTo(map);\\n    geojson.addTo(map);\\n  });\\n\\n};\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EWhat we&#39;ve done there is changed the \u003Ccode\u003E.fitBounds\u003C\u002Fcode\u003E to \u003Ccode\u003E.setView\u003C\u002Fcode\u003E, with the various options mentioned above. Try reloading the file, and you&#39;ll see it loads to the correct place.\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;webmap-05-exercise01.jpg&quot; caption=&quot;Exercise 01&quot; %}\u003C\u002Fp\u003E\\n\u003Ch3 id=\\\"exercise-2-marker-properties\\\"\u003EExercise 2: Marker Properties\u003C\u002Fh3\u003E\\n\u003Cp\u003ENow let&#39;s add the 2001, 1981 and 1991 population property to each marker popup. You can use HTML to style your popup window. To do so, we again need to edit the javascript.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-javascript\\\"\u003Ewindow.onload = function () {\\n    var basemap = L.tileLayer(&#39;http:\u002F\u002F{s}.tile.osm.org\u002F{z}\u002F{x}\u002F{y}.png&#39;, {\\n    attribution: &#39;&amp;copy; &lt;a href=&quot;http:\u002F\u002Fosm.org\u002Fcopyright&quot;&gt;OpenStreetMap&lt;\u002Fa&gt; contributors&#39;\\n  });\\n\\n    $.getJSON(&quot;census.geojson&quot;, function(data) {\\n\\n    var geojson = L.geoJson(data, {\\n      onEachFeature: function (feature, layer) {\\n        layer.bindPopup(feature.properties.Area_Name + &#39;&lt;p&gt;&lt;b&gt; 2001 Population: &#39; + feature.properties.Pop_2001 + &#39;&lt;\u002Fb&gt;&lt;\u002Fp&gt;&#39; + &#39;&lt;p&gt;&lt;b&gt; 1981 Population: &#39; + feature.properties.Pop_1981 + &#39;&lt;\u002Fb&gt;&lt;\u002Fp&gt;&#39; + &#39;&lt;p&gt;&lt;b&gt; 1801 Population &#39; + feature.properties.Pop_1801 + &#39;&lt;\u002Fb&gt;&lt;\u002Fp&gt;&#39;);\\n        \u002F\u002FEDIT HERE\\n      }\\n    });\\n\\n\\n    var map = L.map(&#39;my-map&#39;)\\n    \u002F\u002F.fitBounds(geojson.getBounds());\\n    .setView([51.505,-0.09], 9);\\n\\n    basemap.addTo(map);\\n    geojson.addTo(map);\\n  });\\n\\n};\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EWhat we&#39;ve done here is edit the \u003Ca href=\\\"http:\u002F\u002Fleafletjs.com\u002Freference-1.2.0.html#geojson-oneachfeature\\\"\u003EonEachFeature function\u003C\u002Fa\u003E, which gets called for each feature (in this case, each marker popup) to add additional information about each marker contained in our \u003Ccode\u003Ecensus.geojson\u003C\u002Fcode\u003E data. To add attribute information from our \u003Ccode\u003Ecensus.geojson\u003C\u002Fcode\u003E file, we use the convention \u003Ccode\u003Efeature.properties.ATTRIBUTE_NAME\u003C\u002Fcode\u003E to access the population data. In this case, we are adding \u003Ccode\u003Efeature.properties.Pop_2001\u003C\u002Fcode\u003E, \u003Ccode\u003Efeature.properties.Pop_1981\u003C\u002Fcode\u003E, and \u003Ccode\u003Efeature.properties.Pop_1801\u003C\u002Fcode\u003E, and adding a bit of styling with html for readability.\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;webmap-06-exercise02.jpg&quot; caption=&quot;Exercise 02&quot; %}\u003C\u002Fp\u003E\\n\u003Ch3 id=\\\"exercise-3-change-data-source\\\"\u003EExercise 3: Change Data Source\u003C\u002Fh3\u003E\\n\u003Cp\u003EChange the data source to a different dataset, as an example you can use the \u003Ca href=\\\"\u002Fassets\u002Fmapping-with-python-leaflet\u002Fexercises\u002Fexercise03\u002Fstations.geojson\\\"\u003Estations.geojson\u003C\u002Fa\u003E file.\u003C\u002Fp\u003E\\n\u003Cp\u003ETo do this, we need to edit the javascript file.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-javascript\\\"\u003Ewindow.onload = function () {\\n    var basemap = L.tileLayer(&#39;http:\u002F\u002F{s}.tile.osm.org\u002F{z}\u002F{x}\u002F{y}.png&#39;, {\\n    attribution: &#39;&amp;copy; &lt;a href=&quot;http:\u002F\u002Fosm.org\u002Fcopyright&quot;&gt;OpenStreetMap&lt;\u002Fa&gt; contributors&#39;\\n  });\\n\\n    $.getJSON(&quot;stations.geojson&quot;, function(data) {\\n\\n    var geojson = L.geoJson(data, {\\n      onEachFeature: function (feature, layer) {\\n        layer.bindPopup(feature.properties.name + &#39;&lt;p&gt;&lt;b&gt; Line: &#39; + feature.properties.line + &#39;&lt;\u002Fb&gt;&lt;\u002Fp&gt;&#39;);\\n        \u002F\u002FEDIT HERE\\n      }\\n    });\\n\\n\\n    var map = L.map(&#39;my-map&#39;)\\n    .fitBounds(geojson.getBounds());\\n    \u002F\u002F .setView([51.505,-0.09], 9);\\n    \u002F\u002F EDIT HERE\\n\\n    basemap.addTo(map);\\n    geojson.addTo(map);\\n  });\\n\\n};\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003ESince we&#39;re loading a new dataset, we need a new view for our map. First, we&#39;ve replaced \u003Ccode\u003Ecensus.geojson\u003C\u002Fcode\u003E with \u003Ccode\u003Estations.geojson\u003C\u002Fcode\u003E to our $getJSON request. Next, we add the attribute information found in our \u003Ccode\u003Estations.geojson\u003C\u002Fcode\u003E file, including the name (\u003Ccode\u003Efeature.properties.name\u003C\u002Fcode\u003E) and line (\u003Ccode\u003Efeatures.properties.line\u003C\u002Fcode\u003E). Finally, we are using the \u003Ccode\u003E.fitBounds\u003C\u002Fcode\u003E function so that the viewport automatically centers on our new set of data points.\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;webmap-07-exercise03.jpg&quot; caption=&quot;Exercise 03&quot; %}\u003C\u002Fp\u003E\\n\u003Ch3 id=\\\"exercise-4-custom-basemap\\\"\u003EExercise 4: Custom Basemap\u003C\u002Fh3\u003E\\n\u003Cp\u003EChange your data source back to \u003Ccode\u003Ecensus.geojson\u003C\u002Fcode\u003E. Change your basemap layer to a mapbox tileset.  You need to get a Mapbox account, create a map or style and get your Mapbox API access token.\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;webmap-04-mapboxAPI.png&quot; caption=&quot;Mapbox API&quot; %}\u003C\u002Fp\u003E\\n\u003Cp\u003EFirst, you will need to add a reference to the mapbox javascript and css libraries:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-html\\\"\u003E&lt;!DOCTYPE html&gt;\\n&lt;head&gt;\\n&lt;link rel=&quot;stylesheet&quot; href=&quot;http:\u002F\u002Fcdn.leafletjs.com\u002Fleaflet-0.6.4\u002Fleaflet.css&quot; \u002F&gt;\\n&lt;script src=&quot;http:\u002F\u002Fcdn.leafletjs.com\u002Fleaflet-0.6.4\u002Fleaflet.js&quot;&gt;&lt;\u002Fscript&gt;\\n&lt;script src=&quot;https:\u002F\u002Fcode.jquery.com\u002Fjquery-2.1.4.min.js&quot;&gt;&lt;\u002Fscript&gt;\\n&lt;!-- EDIT HERE --&gt;\\n&lt;script src=&#39;https:\u002F\u002Fapi.mapbox.com\u002Fmapbox.js\u002Fv2.2.1\u002Fmapbox.js&#39;&gt;&lt;\u002Fscript&gt;\\n&lt;link href=&#39;https:\u002F\u002Fapi.mapbox.com\u002Fmapbox.js\u002Fv2.2.1\u002Fmapbox.css&#39; rel=&#39;stylesheet&#39; \u002F&gt;\\n&lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot; \u002F&gt;\\n&lt;\u002Fhead&gt;\\n\\n&lt;body&gt;\\n  &lt;div id=&quot;my-map&quot;&gt;&lt;\u002Fdiv&gt;\\n&lt;\u002Fbody&gt;\\n&lt;script src=&#39;leafletmap.js&#39;&gt;&lt;\u002Fscript&gt;\\n\\n&lt;\u002Fhtml&gt;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThen we edit the javascript file:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-javascript\\\"\u003E\\nwindow.onload = function () {\\n     var basemap = L.tileLayer(&#39;http:\u002F\u002F{s}.tile.osm.org\u002F{z}\u002F{x}\u002F{y}.png&#39;, {\\n     attribution: &#39;&amp;copy; &lt;a href=&quot;http:\u002F\u002Fosm.org\u002Fcopyright&quot;&gt;OpenStreetMap&lt;\u002Fa&gt; contributors&#39;\\n   });\\n\\n    \u002F\u002F EDIT HERE: get an access token, replace &#39;YOURTOKENHERE&#39; with something like &quot;pk.eyJ1Ijoia2ltcGhhbTU0IiwiYSI6IkdJX0tvM2cifQ.fVsdGC_QJrFYZ3SxZCsvhQ&quot;\\n    L.mapbox.accessToken = &#39;YOURTOKENHERE&#39;;\\n\\n    \u002F\u002F EDIT HERE: add the new baselayer style, replace &#39;YOURLINKHERE&#39; with something like &quot;kimpham54.au2i6bt9&quot;\\n    var basemap = L.tileLayer(&#39;https:\u002F\u002Fapi.mapbox.com\u002Fv4\u002Fkimpham54.au2i6bt9\u002F{z}\u002F{x}\u002F{y}.png?access_token=&#39; + L.mapbox.accessToken, {\\n        attribution: &#39;&lt;a href=&quot;https:\u002F\u002Fwww.mapbox.com\u002Ftos\u002F&quot;&gt;Mapbox&lt;\u002Fa&gt;&#39;\\n      });\\n\\n    $.getJSON(&quot;stations.geojson&quot;, function(data) {\\n\\n    var geojson = L.geoJson(data, {\\n      onEachFeature: function (feature, layer) {\\n        layer.bindPopup(feature.properties.name + &#39;&lt;p&gt;&lt;b&gt; Line: &#39; + feature.properties.line + &#39;&lt;\u002Fb&gt;&lt;\u002Fp&gt;&#39;);\\n        \u002F\u002F EDIT HERE\\n      }\\n    });\\n\\n\\n    var map = L.map(&#39;my-map&#39;)\\n    .fitBounds(geojson.getBounds());\\n    \u002F\u002F.setView([51.505,-0.09], 9);\\n    \u002F\u002F EDIT HERE\\n\\n    basemap.addTo(map);\\n    geojson.addTo(map);\\n  });\\n\\n};\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EIn the javascript file, we&#39;ve added our mapbox token in order to access the mapbox API that allows us to access the mapbox basemap that we want to use. Your final result (with your own basemap of choice) should look something like this:\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;webmap-08-exercise04.jpg&quot; caption=&quot;Exercise 04&quot; %}\u003C\u002Fp\u003E\\n\u003Ch3 id=\\\"exercise-5-custom-marker-icon\\\"\u003EExercise 5: Custom Marker Icon\u003C\u002Fh3\u003E\\n\u003Cp\u003EAdd a custom leaf icon, as an example you can use \u003Ca href=\\\"\u002Fassets\u002Fmapping-with-python-leaflet\u002Fexercises\u002Fexercise05\u002Fleaf.png\\\"\u003Eleaf.png\u003C\u002Fa\u003E. Or use your own!\u003C\u002Fp\u003E\\n\u003Cp\u003EIn this exercise, we only need to edit the javascript file:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-javascript\\\"\u003Ewindow.onload = function () {\\n\\n    L.mapbox.accessToken = &#39;YOURTOKENHERE&#39;;\\n\\n    var basemap = L.tileLayer(&#39;https:\u002F\u002Fapi.mapbox.com\u002Fv4\u002FYOURLINKHERE\u002F{z}\u002F{x}\u002F{y}.png?access_token=&#39; + L.mapbox.accessToken, {\\n        attribution: &#39;&lt;a href=&quot;https:\u002F\u002Fwww.mapbox.com\u002Ftos\u002F&quot;&gt;Mapbox&lt;\u002Fa&gt;&#39;\\n      });\\n\\n    $.getJSON(&quot;stations.geojson&quot;, function(data) {\\n\\n    var geojson = L.geoJson(data, {\\n\\n\u002F\u002FEDIT HERE\\n      pointToLayer: function (feature, latlng) {\\n       var smallIcon = L.icon({\\n                          iconSize: [27, 27],\\n                          iconAnchor: [13, 27],\\n                          popupAnchor:  [1, -24],\\n                          iconUrl: &#39;leaf.png&#39;\\n                  });\\n\\n         return L.marker(latlng, {icon: smallIcon});\\n        },\\n\\n      onEachFeature: function (feature, layer) {\\n        layer.bindPopup(feature.properties.name + &#39;&lt;p&gt;&lt;b&gt; Line: &#39; + feature.properties.line + &#39;&lt;\u002Fb&gt;&lt;\u002Fp&gt;&#39;);\\n      }\\n\\n    });\\n\\n\\n    var map = L.map(&#39;my-map&#39;)\\n    .fitBounds(geojson.getBounds());\\n    \u002F\u002F.setView([51.505,-0.09], 9);\\n\\n    basemap.addTo(map);\\n    geojson.addTo(map);\\n  });\\n\\n};\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EMarker icons are defined in leaflet using the \u003Ccode\u003EL.icon\u003C\u002Fcode\u003E object. We specify the image are using to replace our marker by using the property \u003Ccode\u003EiconUrl\u003C\u002Fcode\u003E. Make sure that you specify the proper path to your image.  We specified a few additional properties, such as iconSize (dimensions of the icon in pixels), iconAnchor (coordinates of the icon which will correspond to marker&#39;s location), popupAnchor (coordinates from which the popup should open relative to the iconAnchor). Check out the \u003Ca href=\\\"http:\u002F\u002Fleafletjs.com\u002Freference-1.2.0.html#icon\\\"\u003EIcon Leaflet documentation\u003C\u002Fa\u003E more information about \u003Ccode\u003EL.Icon\u003C\u002Fcode\u003E properties.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe final map should look something like this:\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;webmap-09-exercise05.jpg&quot; caption=&quot;Exercise 05&quot; %}\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"next-steps\\\"\u003ENext Steps\u003C\u002Fh2\u003E\\n\u003Cp\u003ECongratulations! You now have some hands-on experience geocoding using common Python data analysis libraries and working with one of the most popular Javascript web mapping libraries out there.\u003C\u002Fp\u003E\\n\u003Cp\u003EIf you want to explore other web mapping features with Leaflet, there are a number of additional \u003Ca href=\\\"http:\u002F\u002Fleafletjs.com\u002Fplugins.html\\\"\u003Eplugins\u003C\u002Fa\u003E to try out. Of particular interest may be ability to create \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fskeate\u002FLeaflet.timeline\\\"\u003Etime based visualizations\u003C\u002Fa\u003E and do \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fpa7\u002Fheatmap.js\\\"\u003Eheat-mapping\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003EAlso, check out the Programming Historian Lesson \u003Ca href=\\\"\u002Flessons\u002Fusing-javascript-to-create-maps\\\"\u003EUsing Javascript to Create Maps of Correspondence\u003C\u002Fa\u003E that goes in depth on how to analyze correspondence using geospatial software, and using some of the same tools as this lesson.\u003C\u002Fp\u003E\\n\"}"}</script></div>
	</body>
</html>
