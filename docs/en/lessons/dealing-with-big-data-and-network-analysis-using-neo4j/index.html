<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="description" content="" />
		<link rel="icon" href="/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		

		

		<link rel="stylesheet" href="/_app/assets/start-61d1577b.css">
		<link rel="modulepreload" href="/_app/start-a80c730b.js">
		<link rel="modulepreload" href="/_app/chunks/vendor-9b9d6288.js">
		<link rel="modulepreload" href="/_app/pages/__layout.svelte-de46afb2.js">
		<link rel="modulepreload" href="/_app/pages/_lang_/__layout.svelte-e75718c6.js">
		<link rel="modulepreload" href="/_app/chunks/stores-191d1505.js">
		<link rel="modulepreload" href="/_app/pages/_lang_/_lessons_/_slug_/index.svelte-efe77d76.js">

		<script type="module">
			import { start } from "/_app/start-a80c730b.js";
			start({
				target: document.querySelector("#svelte"),
				paths: {"base":"","assets":""},
				session: {},
				route: true,
				spa: false,
				trailing_slash: "never",
				hydrate: {
					status: 200,
					error: null,
					nodes: [
						import("/_app/pages/__layout.svelte-de46afb2.js"),
						import("/_app/pages/_lang_/__layout.svelte-e75718c6.js"),
						import("/_app/pages/_lang_/_lessons_/_slug_/index.svelte-efe77d76.js")
					],
					url: new URL("sveltekit://prerender/en/lessons/dealing-with-big-data-and-network-analysis-using-neo4j"),
					params: {lang:"en",lessons:"lessons",slug:"dealing-with-big-data-and-network-analysis-using-neo4j"}
				}
			});
		</script><script>
			if ('serviceWorker' in navigator) {
				navigator.serviceWorker.register('/service-worker.js');
			}
		</script>
	</head>
	<body>
		<div id="svelte">


The Programming Historian <a href="/en">English</a> <a href="/es">Spanish</a>
<br>
This is the en edition.

<h1>Dealing with Big Data and Network Analysis Using Neo4j</h1>

<!-- HTML_TAG_START --><p>{% include toc.html %}</p>
<h1 id="introduction">Introduction</h1>
<p>In this lesson we will learn how to use a graph database to store and analyze complex networked information.
Networks are all around us.
Social scientists use networks to better understand how people are connected.
This information can be used to understand how things like rumors or even communicable diseases can spread throughout a community of people.</p>
<p>The patterns of relationships that people maintain with others captured in a network can also be used to make inferences about a person&#39;s position in society.
For example, a person with many social ties is likely to receive information more quickly than someone who maintains very few connections with others.
Using common network terminology, one would say that a person with many ties is more central in a network, and a person with few ties is more peripheral in a network.
Having access to more information is generally believed to be advantageous.
Similarly, if someone is very well-connected to many other people that are themselves well-connected than we might infer that these individuals have a higher social status.</p>
<p>Network analysis is useful to understand the implications of ties between organizations as well.
Before he was appointed to the Supreme Court of the United States, Louis Brandeis called attention to how anti-competitive activities were often organized through a web of appointments that had directors sitting on the boards of multiple ostensibly competing corporations.
Since the 1970s sociologists have taken a more formal network-based approach to examining the network of so-called corporate interlocks that exist when directors sit on the boards of multiple corporations.
Often these ties are innocent, but in some cases they can be indications of morally or legally questionable activities.
The recent release of the
<a href="https://neo4j.com/blog/icij-releases-neo4j-desktop-download-paradise-papers/">Paradise Papers</a> by
the
<a href="https://icij.org">International Consortium of Investigative Journalists</a>
and the ensuing news scandals throughout the world
shows how important understanding relationships between people and organizations can be.</p>
<p>This tutorial will focus on the <a href="https://neo4j.com/">Neo4j graph database</a>, and the <a href="https://neo4j.com/developer/cypher-query-language/">Cypher
query language</a> that comes with it.</p>
<ul>
<li><a href="https://neo4j.com/">Neo4j</a> is a free, open-source graph database
written in java that is available for all major computing platforms.</li>
<li><a href="https://neo4j.com/developer/cypher-query-language/">Cypher</a> is the
query language for the Neo4j database that is designed to insert and
select information from the database.</li>
</ul>
<p>By the end of this lesson you will be able to construct, analyze and
visualize networks based on big --- or just inconveniently large --- data.
The final section of this lesson contains code and data to illustrate the key points of this lesson.</p>
<p>Although beyond the scope of this tutorial, those interested in trying to better understand social networks
can refer to a number of sources.
Sociologists Robert A. Hanneman and Mark Riddle maintain an <a href="http://faculty.ucr.edu/~hanneman/nettext/">on-line textbook on network analysis</a>.
There are also regular conferences hosted and useful resources available from the <a href="http://www.insna.org">International Network for Social Network Analysis</a>.</p>
<div class="alert alert-warning">
I strongly recommend that you read the lesson through before trying the example data.
Wherever possible I have included links back to more detailed documentation or tutorials.
</div>

<h1 id="what-is-neo4j-and-why-use-it">What is Neo4j and why use it?</h1>
<p>Neo4j is a specialized database that manages graphs. Traditional
database software stores information in tables -- much like data is displayed in Excel
spreadsheets except on a much larger scale. Neo4j is also concerned with storing large
amounts of data but it is primarily designed to capture the relationship between items of
information. Therefore, the organizing principle underlying Neo4j is to store information as a network of relationships rather than a table. Networks contain nodes and nodes are connected through
ties. (Nodes are also referred to as &quot;vertices&quot; and ties are referred to as &quot;edges&quot; or links. Networks are also frequently referred to as graphs.)</p>
<p>Databases are designed for dealing with large amounts of data.
However, when working with small datasets it is often more efficient not to use a database.
The <em>Programming Historian</em> has excellent tutorials for dealing with network data.
For an introduction, see <a href="/lessons/exploring-and-analyzing-network-data-with-python">Exploring and Analyzing Network Data with Python</a>.</p>
<h1 id="installing-and-creating-a-neo4j-database">Installing and creating a Neo4j database</h1>
<p>Neo4j is currently the most popular graph database on the market.
It is also well documented and open-source so this tutorial will focus on it.
Accessing information within this type of database is as easy as following connections across the nodes of the graph.</p>
<h2 id="installation">Installation</h2>
<p>The first step to install Neo4j is to download the <a href="https://neo4j.com/product/">community edition of Neo4j</a>.
The software you want is called <strong>Neo4j Desktop</strong>.</p>
<p>{% include figure.html filename=&quot;new_neo4j_download.png&quot; caption=&quot;Neo4j Desktop download&quot; %}</p>
<p>Neo4j has recently changed the way the database is installed.
Once you download the desktop and install it you will be prompted to enter your user name and password.
At this point, you can choose to log in with an existing social media account or create a new login name and password.</p>
<div class="alert alert-warning">
You may be prompted to update the software. Our recommendation is to allow the installation to continue and update the software afterwards.
</div>

<p>Once you start the Neo4j Desktop installation process, the software will take care of installing all of the software it depends on including the latest Java Runtime Environment it depends on.
This step requires that you have a connection to the Internet.</p>
<p>{% include figure.html filename=&quot;new_neo4j_desktop_install.png&quot; caption=&quot;Neo4j Desktop installation&quot; %}</p>
<h2 id="creating-a-new-project">Creating a new project</h2>
<p>When the Neo4j Desktop starts for the first time, you will see a list of icons on the far left.
The topmost icon is a small file folder. This is the projects tab.
You can edit projects by simply clicking on a project in the project list.
When you do so, the contents of the project will be displayed on the far right of the application (the part with the white background).</p>
<p>{% include figure.html filename=&quot;neo4j-projects.png&quot; caption=&quot;Neo4j Desktop - Projects tab&quot; %}</p>
<h2 id="adding-a-database-to-the-project">Adding a database to the project</h2>
<p>Adding a new database to a project is simply a matter of clicking &quot;New Database&quot;.
Choose the &quot;Local&quot; option because we will store an example database to your local machine.
You will then have the option to change the name of your database, the Neo4j version that runs the database, and add a description.
We will simply stay with the defaults, but you can change these options later.</p>
<p>{% include figure.html filename=&quot;new_neo4j_add_db.png&quot; caption=&quot;Neo4j Desktop - Adding a new database to a project.&quot; %}</p>
<p>After the database is created you will see two buttons underneath.</p>
<p>{% include figure.html filename=&quot;new-neo4j-db-options.png&quot; caption=&quot;Manage options of your database&quot; %}</p>
<p>Click on &quot;Manage&quot; and you will be presented with a series of options to customize your database.
Now that we have the Neo4j database installed, we need to add some example data so we can use it.</p>
<h2 id="loading-data-into-neo4j">Loading Data into Neo4j</h2>
<p>The easiest way to load data into the Neo4j database is to load the information you are interested in using comma separated value (CSV) files.
You will need to separate your data into data for nodes and data for edges.
This is a common way for network information to be separated.
In this lesson we will use some example data that has already been formatted.</p>
<p>Using the CSV batch loading mechanism in Neo4j is the fastest way to import data into your new database.
In this section I am going to talk about the process more generally for simple cases.
This process assumes that you have an empty database.</p>
<p><strong>If you want to follow along, you can download the example data files
<a href="/assets/dealing-with-big-data-and-network-analysis-using-neo4j/nodes_companies.csv">nodes_companies.csv</a> and
<a href="/assets/dealing-with-big-data-and-network-analysis-using-neo4j/edges_director_duration.csv">edges_director_duration.csv</a>.
The canonical guide to loading data from CSV is on <a href="https://neo4j.com/developer/guide-import-csv/">the Neo4j website</a>.</strong></p>
<p>Now that we have the example CSV files downloaded, we will use the <strong>Cypher</strong> query language to load them into our empty Neo4j database.
Cypher is a specialized query language that is designed to load and manipulate data in the Neo4j database.</p>
<h2 id="formatting-csv-files-for-loading-into-neo4j">Formatting CSV files for loading into Neo4j</h2>
<p>The columns in each CSV will have to be properly named to tell the import tools how to properly create relationships.</p>
<p>Let&#39;s examine the basic format of the two CSV files we downloaded.</p>
<p><strong>nodes_nodes_companies.csv</strong></p>
<table>
<thead>
<tr>
<th>companyId</th>
<th>name</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>CANADIAN BANK OF COMMERCE</td>
</tr>
<tr>
<td>2</td>
<td>SHAWINIGAN WATER AND POWER</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
</tr>
</tbody></table>
<p><strong>edges_director_duration.csv</strong></p>
<table>
<thead>
<tr>
<th>START_ID</th>
<th>years_served</th>
<th>END_ID</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>281</td>
<td>10</td>
<td>422</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
</tbody></table>
<p>By looking at the two data files we can see that the Canadian Bank of Commerce and Shawinigan Water and Power have both employed the same director for 2 years.
(The first row of edges_director_duration.csv shows the start node with the Canadian Bank of Commerce ID and the Shawinigan Water and Power ID as the end node.)
This director effectively acts as a tie (also known as a corporate interlock) between the two companies.</p>
<p>Note that we could just as easily make the directors the nodes and the companies the edges that connect them.
This would give us a clearer picture of the professional network that unites individual directors.</p>
<p>Another alternative would be to represent both Companies and Directors as node types.
Directors would still act to tie the boards of companies together but there would be a different relationship between the nodes.</p>
<div class="alert alert-warning">
Depending on your data and your research questions you will need to decide what is the most sensible way to represent data for your application.
Take your time on this phase of your project -- this is a crucial decision that will affect every other aspect of your project going forward.
</div>

<p>We&#39;ll talk more about defining relationships and nodes below.</p>
<h1 id="using-cypher">Using Cypher</h1>
<p>In order to create a network in Neo4j we will load the nodes into the database followed by the information about the edges that connect these nodes together.
The process of loading data from a CSV file into Neo4j is relatively straightforward.
We are going to:</p>
<ul>
<li>Place our CSV files so they can be accessed by Neo4j</li>
<li>Start the database.</li>
<li>Open the browser and connect to the database so we can run a <strong>Cypher</strong> command.</li>
<li>Using Cypher, we will load our specially formatted CSV files into the database.</li>
</ul>
<p>This process assumes that your data is cleanly separated into node and edge CSV files.</p>
<h2 id="moving-the-csv-files-to-the-import-directory">Moving the CSV files to the import directory</h2>
<p>Click on the &quot;Manage&quot; button in the database pane, then the drop down menu next to &quot;Open Folders&quot; and select &quot;Import.&quot; A window will appear with a directory.</p>
<p>{% include figure.html filename=&quot;new-neo4j-files.png&quot; caption=&quot;Pressing the Open Folders button&quot; %}</p>
<p>You now need to copy the
<code>nodes_nodes_companies.csv</code> and the <code>edges_director_duration.csv</code> files there.
Now we can use a Cypher command to load the files.</p>
<p>{% include figure.html filename=&quot;importing.png&quot; caption=&quot;Moving the files to this directory&quot; %}</p>
<h2 id="start-the-database">Start the database</h2>
<p>In order to start the database, press the triangular play icon.</p>
<p>{% include figure.html filename=&quot;new-neo4j-start-db.png&quot; caption=&quot;Pressing the start database button&quot; %}</p>
<p>In the &quot;Details&quot; tab beneath, you will see information about the database starting.
You&#39;ll notice that the database server is running on &quot;HTTP port 7474&quot;.
Neo4j allows access to the database through a web server. In the next step, we will open
a browser to connect to the database.</p>
<h2 id="opening-the-browser">Opening the browser</h2>
<p>Click on the &quot;Open Browser&quot; button. A new browser window will appear.</p>
<p>First, you will need to login to your new database. By default,
 the username and password are both <code>neo4j</code>. After you log in the
  first time, you will be prompted to create a new password.</p>
<p>At the top of the window is a prompt with a blinking cursor.
We can add our Cypher command to load our data here</p>
<p>{% include figure.html filename=&quot;new-neo4j-browser.png&quot; caption=&quot;Browser window&quot; %}</p>
<h3 id="using-cypher-to-load-the-csv-files-into-the-database">Using Cypher to load the CSV files into the database</h3>
<p>Again, press the trianglar run icon &quot;&gt;&quot; in order to execute the command. An example can be seen in the screenshot below:</p>
<p>{% include figure.html filename=&quot;new-neo4j-load1.png&quot; caption=&quot;Cypher command window: loading nodes into the database&quot; %}</p>
<pre><code class="language-sql">LOAD CSV with headers FROM &quot;file:///nodes_companies.csv&quot; as nodes
CREATE (n:COMPANY { id:toInteger(nodes.companyId), name:nodes.name })
</code></pre>
<p>The Cypher command LOADs the CSV file that contains informative headers (i.e. the first line)
from the file we placed in the import directory. (By default, Neo4j can only load files from this directory.)
The results will be stored as an object called <strong>nodes</strong>.</p>
<p>The second line CREATEs data in our database. In particular, we create a series of node objects of the type COMPANY
that contain a <code>name</code> and an <code>id</code>. We set the name of this new company node to the name stored in the <code>nodes.name</code> object and the id to the same as stored in the <code>nodes.companyID</code>.
Notice that the fields that are stored in the nodes object corresponds to the headers we set in the CSV files.
We also use the <code>toInteger()</code> function to make sure our numbers are represented as integers and not as text.</p>
<p>Next we need to load the edge data.</p>
<p>This command does something similar. However, a new command called MATCH has been introduced.
The first line loads the CSV file from the import directory and assigns it to a variable called <strong>edges</strong>.
The next two lines use MATCH. The first line goes to the existing database and finds a COMPANY node with
an id the same as START_ID. The next line does the same thing, except looks for a match with the END_ID column
in the CSV file. These results are assigned to the variables <code>a</code> and <code>b</code>, respectively.</p>
<p>The final line CREATES a relationship between these nodes. In this case, the relationship type is called INTERLOCK.
There is a field called years within the INTERLOCK that is set to the years_served value from the CSV.</p>
<pre><code class="language-sql">LOAD CSV WITH HEADERS FROM &quot;file:///edges_director_duration.csv&quot; AS edges
MATCH (a:COMPANY { id: toInteger(edges.START_ID) })
MATCH (b:COMPANY { id: toInteger(edges.END_ID)   })
CREATE (a)-[r:INTERLOCK{weight:toInteger(edges.years_served)}]-&gt;(b);
</code></pre>
<p><strong>Note: If you have difficulties during the loading process, you can delete all of the nodes and
edges in your database using the following command.</strong></p>
<pre><code>MATCH (n)
DETACH DELETE n
</code></pre>
<h3 id="using-the-cypher-query-language">Using the Cypher query language</h3>
<p>Cypher is a powerful language to query graph databases.
Cypher is a language dedicated to loading, selecting or altering data that is stored in the Neo4j database.
The following sections will show examples of these actions.</p>
<p>The key to effectively querying Neo4j is to understand that information in the database is represented as a graph and not a table.
Therefore, you need to consider the information you&#39;re working with in terms of <strong>nodes</strong> and <strong>relationships</strong> that connect nodes together.</p>
<p>A typical Cypher statement shows the relationship between two nodes.</p>
<p>For example, we can create a new COMPANY node:</p>
<pre><code>CREATE (acompany:COMPANY { id:900, name:&quot;Economical Mutual Fire Insurance Company of Berlin&quot;})
</code></pre>
<p>In this example, <code>acompany</code> is the variable name we have given to the node object we created in the database.
We marked the node object as being a <code>COMPANY</code> type.
A COMPANY has an attribute called <code>id</code> which is a unique number assigned to that particular company.
In the examples above, each entry also has a <code>name</code> field.
We can use this unique id to query the database for information about the ties from each firm</p>
<p>Now suppose that the database already contains data and we aren&#39;t sure if there is information about a given company.
In this case, we can use the MATCH statement to match a unique node and manipulate it.</p>
<p>In the following example, we MATCH both the companynodes (represented by the variables c and p).
The CREATE statement then uses the match for each company and CREATEs a relationship between the two nodes.
In this case, the relationship is of the type INTERLOCK.</p>
<pre><code>MATCH  (c1:COMPANY {companyId:281})
MATCH  (c2:COMPANY {companyId:879})
CREATE (c1)-[r:INTERLOCK{weight:10}]-&gt;(c2)
RETURN c1,c2,r;
</code></pre>
<p>Note that the relationship (r) here is between the two companies.
The relationship between COMPANIES is defined as an INTERLOCK.
But it is important to note that we can define multiple different kinds of nodes and relationships.</p>
<div class="alert alert-warning">
Data can be represented many different ways.
It is worth carefully considering what insights you want to get out of your data before you commit to a structure in the database.
</div>

<p>Finally, the RETURN statement returns the variables for us to further manipulate.
For example, we might decide to add another attribute to the company.
Here we add a URL attribute to the company object that contains the company&#39;s current web site.</p>
<pre><code>SET c.url = &quot;https://economical.com&quot;;
</code></pre>
<h3 id="reviewing-the-data">Reviewing the data</h3>
<p>The data supplied in the <code>nodes_companies.csv</code> and <code>edges_director_duration.csv</code> files
provides us with the basic corporate interlock network that existed in Canada in 1912.</p>
<p>If we use the web interface that comes with Neo4j we&#39;ll be able to see what parts of this network looks like by using a simple query.</p>
<p>With the Neo4j database running, we can open up the built in browser to make more Cypher queries.
(Or we can put the following URL into  a browser <a href="http://localhost:7474/browser/">http://localhost:7474/browser/</a>.</p>
<p>Add the following Cypher query.</p>
<pre><code class="language-sql">MATCH (n:COMPANY) RETURN n LIMIT 40;
</code></pre>
<p>This query will request that Neo4j find all nodes that are of the type company and return them.
The LIMIT option limits the results to the first 40 nodes.</p>
<p>You should see a network that looks something like this.</p>
<p>{% include figure.html filename=&quot;new-neo4j-simple-match.png&quot; caption=&quot;Neo4j results after a simple query&quot; %}</p>
<h3 id="a-brief-note-on-index">A brief note on INDEX</h3>
<p>Creating an index is important for any database to run efficiently.
An index is a particular field in a database that is designated for the database to optimize so that lookups are as fast as possible.</p>
<p>To create an index in Neo4j, we would issue the following Cypher command.
Creating an index only needs to be done once.</p>
<pre><code>CREATE INDEX ON :COMPANY(id)
</code></pre>
<p>Create another index using the company name as well.</p>
<pre><code>CREATE INDEX ON :COMPANY(name)
</code></pre>
<p>Creating this index will greatly speed up any queries we make based on the unique keys <code>id</code> and <code>name</code>.</p>
<div class="alert alert-warning">
Don't create more indexes than you need.
Creating too many indexes will have the effect of slowing down your database.
Again, designing your database so that you have a unique key to do lookups is crucial.
</div>

<h3 id="querying-neo4j-create-match-set">Querying Neo4j: CREATE, MATCH, SET</h3>
<p>So far we have used the basic syntax of the Cypher query language.
We&#39;ve seen that relationships on a graph are written quite intuitively using Cypher.</p>
<pre><code>(n1:NODE)-[:relationship]-&gt;(n2:NODE)
</code></pre>
<p>In this section we used Cypher to CREATE entries in the database, MATCH existing data, and we used SET to alter existing data we found.</p>
<p>More on the <a href="https://neo4j.com/developer/cypher-query-language/">Cypher query language</a> can be found on the Neo4j
web site.</p>
<h1 id="putting-it-all-together-a-working-example">Putting it all together: A working example</h1>
<p>If we return to the <a href="http://localhost:7474">web interface on your local machine</a> we can query our new database.
Let&#39;s look at the firms that have the greatest number of connections (i.e. the highest degree).
To calculate degree we can make a simple query with Cypher.</p>
<pre><code>MATCH (c:COMPANY)
set c.degree = size((c)--&gt;());
</code></pre>
<p>This code simply matches to each node and counts the size (or degree) of each node.
We use the SET command to set the degree value as an attribute of each node.</p>
<p>Now we can examine those nodes with the highest degree.
Here we list companies where there are 75 or more connections (via high level employees or directors to other companies).</p>
<pre><code>match (c0:COMPANY)-[r]-(c1) where c0.degree &gt; 75
return DISTINCT c0.name;
</code></pre>
<p>This results in the following companies:</p>
<ul>
<li>TORONTO AND YORK RADIAL RAILWAY</li>
<li>MONTREAL ELECTRIC HEAT AND POWER</li>
<li>CANADIAN PACIFIC RAILWAY</li>
<li>TORONTO RAILWAY</li>
<li>DOMINION COAL</li>
<li>CANADIAN GENERAL ELECTRIC</li>
</ul>
<p>We can also try to examine all of the interlocks between these well-connected companies.</p>
<pre><code>match (c0:COMPANY)-[r]-(c1) where c0.degree &gt; 75 and c1.degree &gt; 75
return c0, r, c1;
</code></pre>
<p>{% include figure.html filename=&quot;graph_example.png&quot; caption=&quot;Example graph&quot; %}</p>
<p>You can download the data used in this lesson <a href="http://jgmackay.com/">here</a> (search for the relevant blog posts).
If you make use of this data, please cite the following in addition to this lesson:</p>
<p>Mackay, Jon. 2017. &quot;Canadian Regional and National Business Elites in 1912: Who Was Connected, Who Wasn&#39;t and
Why&quot; In A History of Socially Responsible Business, c.1600--1950, 189-212. Palgrave Studies in the History
of Finance. Palgrave Macmillan.
<a href="https://doi.org/10.1007/978-3-319-60146-5_8">https://doi.org/10.1007/978-3-319-60146-5_8</a>.</p>
<h1 id="conclusion">Conclusion</h1>
<p>In this lesson we&#39;ve introduced the Neo4j graph database.
We&#39;ve shown how we can talk directly to the database using the Cypher query language.
We&#39;ve also shown how easy it is to visualize different parts of graphs stored in Neo4j using
Neo4j&#39;s built in visualization system.
Finally, we&#39;ve also included some data and example code that reinforces the key topics of this lesson.
Wherever possible this lesson has also linked to primary documents and software to make getting started as easy as possible.</p>
<!-- HTML_TAG_END -->

<script type="application/json" data-type="svelte-data" data-url="dealing-with-big-data-and-network-analysis-using-neo4j/raw.json">{"status":200,"statusText":"","headers":{"content-type":"application/json; charset=utf-8"},"body":"{\"metadata\":{\"title\":\"Dealing with Big Data and Network Analysis Using Neo4j\",\"collection\":\"lessons\",\"slug\":\"dealing-with-big-data-and-network-analysis-using-neo4j\",\"authors\":[\"Jon MacKay\"],\"date\":\"2018-02-20T00:00:00.000Z\",\"reviewers\":[\"Ryan Deschamps\",\"François Dominic Laramée\"],\"editors\":[\"Ian Milligan\"],\"difficulty\":3,\"review-ticket\":\"https:\u002F\u002Fgithub.com\u002Fprogramminghistorian\u002Fph-submissions\u002Fissues\u002F87\",\"topics\":[\"network-analysis\"],\"activity\":\"analyzing\",\"abstract\":\"In this lesson we will learn how to use a graph database to store and analyze complex networked information. This tutorial will focus on the Neo4j graph database, and the Cypher query language that comes with it.\",\"layout\":\"lesson\",\"redirect_from\":\"\u002Flessons\u002Fdealing-with-big-data-and-network-analysis-using-neo4j\",\"avatar_alt\":\"Constellation chart\",\"doi\":\"10.46430\u002Fphen0074\"},\"html_body\":\"\u003Cp\u003E{% include toc.html %}\u003C\u002Fp\u003E\\n\u003Ch1 id=\\\"introduction\\\"\u003EIntroduction\u003C\u002Fh1\u003E\\n\u003Cp\u003EIn this lesson we will learn how to use a graph database to store and analyze complex networked information.\\nNetworks are all around us.\\nSocial scientists use networks to better understand how people are connected.\\nThis information can be used to understand how things like rumors or even communicable diseases can spread throughout a community of people.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe patterns of relationships that people maintain with others captured in a network can also be used to make inferences about a person&#39;s position in society.\\nFor example, a person with many social ties is likely to receive information more quickly than someone who maintains very few connections with others.\\nUsing common network terminology, one would say that a person with many ties is more central in a network, and a person with few ties is more peripheral in a network.\\nHaving access to more information is generally believed to be advantageous.\\nSimilarly, if someone is very well-connected to many other people that are themselves well-connected than we might infer that these individuals have a higher social status.\u003C\u002Fp\u003E\\n\u003Cp\u003ENetwork analysis is useful to understand the implications of ties between organizations as well.\\nBefore he was appointed to the Supreme Court of the United States, Louis Brandeis called attention to how anti-competitive activities were often organized through a web of appointments that had directors sitting on the boards of multiple ostensibly competing corporations.\\nSince the 1970s sociologists have taken a more formal network-based approach to examining the network of so-called corporate interlocks that exist when directors sit on the boards of multiple corporations.\\nOften these ties are innocent, but in some cases they can be indications of morally or legally questionable activities.\\nThe recent release of the\\n\u003Ca href=\\\"https:\u002F\u002Fneo4j.com\u002Fblog\u002Ficij-releases-neo4j-desktop-download-paradise-papers\u002F\\\"\u003EParadise Papers\u003C\u002Fa\u003E by\\nthe\\n\u003Ca href=\\\"https:\u002F\u002Ficij.org\\\"\u003EInternational Consortium of Investigative Journalists\u003C\u002Fa\u003E\\nand the ensuing news scandals throughout the world\\nshows how important understanding relationships between people and organizations can be.\u003C\u002Fp\u003E\\n\u003Cp\u003EThis tutorial will focus on the \u003Ca href=\\\"https:\u002F\u002Fneo4j.com\u002F\\\"\u003ENeo4j graph database\u003C\u002Fa\u003E, and the \u003Ca href=\\\"https:\u002F\u002Fneo4j.com\u002Fdeveloper\u002Fcypher-query-language\u002F\\\"\u003ECypher\\nquery language\u003C\u002Fa\u003E that comes with it.\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fneo4j.com\u002F\\\"\u003ENeo4j\u003C\u002Fa\u003E is a free, open-source graph database\\nwritten in java that is available for all major computing platforms.\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fneo4j.com\u002Fdeveloper\u002Fcypher-query-language\u002F\\\"\u003ECypher\u003C\u002Fa\u003E is the\\nquery language for the Neo4j database that is designed to insert and\\nselect information from the database.\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003EBy the end of this lesson you will be able to construct, analyze and\\nvisualize networks based on big --- or just inconveniently large --- data.\\nThe final section of this lesson contains code and data to illustrate the key points of this lesson.\u003C\u002Fp\u003E\\n\u003Cp\u003EAlthough beyond the scope of this tutorial, those interested in trying to better understand social networks\\ncan refer to a number of sources.\\nSociologists Robert A. Hanneman and Mark Riddle maintain an \u003Ca href=\\\"http:\u002F\u002Ffaculty.ucr.edu\u002F~hanneman\u002Fnettext\u002F\\\"\u003Eon-line textbook on network analysis\u003C\u002Fa\u003E.\\nThere are also regular conferences hosted and useful resources available from the \u003Ca href=\\\"http:\u002F\u002Fwww.insna.org\\\"\u003EInternational Network for Social Network Analysis\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cdiv class=\\\"alert alert-warning\\\"\u003E\\nI strongly recommend that you read the lesson through before trying the example data.\\nWherever possible I have included links back to more detailed documentation or tutorials.\\n\u003C\u002Fdiv\u003E\\n\\n\u003Ch1 id=\\\"what-is-neo4j-and-why-use-it\\\"\u003EWhat is Neo4j and why use it?\u003C\u002Fh1\u003E\\n\u003Cp\u003ENeo4j is a specialized database that manages graphs. Traditional\\ndatabase software stores information in tables -- much like data is displayed in Excel\\nspreadsheets except on a much larger scale. Neo4j is also concerned with storing large\\namounts of data but it is primarily designed to capture the relationship between items of\\ninformation. Therefore, the organizing principle underlying Neo4j is to store information as a network of relationships rather than a table. Networks contain nodes and nodes are connected through\\nties. (Nodes are also referred to as &quot;vertices&quot; and ties are referred to as &quot;edges&quot; or links. Networks are also frequently referred to as graphs.)\u003C\u002Fp\u003E\\n\u003Cp\u003EDatabases are designed for dealing with large amounts of data.\\nHowever, when working with small datasets it is often more efficient not to use a database.\\nThe \u003Cem\u003EProgramming Historian\u003C\u002Fem\u003E has excellent tutorials for dealing with network data.\\nFor an introduction, see \u003Ca href=\\\"\u002Flessons\u002Fexploring-and-analyzing-network-data-with-python\\\"\u003EExploring and Analyzing Network Data with Python\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Ch1 id=\\\"installing-and-creating-a-neo4j-database\\\"\u003EInstalling and creating a Neo4j database\u003C\u002Fh1\u003E\\n\u003Cp\u003ENeo4j is currently the most popular graph database on the market.\\nIt is also well documented and open-source so this tutorial will focus on it.\\nAccessing information within this type of database is as easy as following connections across the nodes of the graph.\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"installation\\\"\u003EInstallation\u003C\u002Fh2\u003E\\n\u003Cp\u003EThe first step to install Neo4j is to download the \u003Ca href=\\\"https:\u002F\u002Fneo4j.com\u002Fproduct\u002F\\\"\u003Ecommunity edition of Neo4j\u003C\u002Fa\u003E.\\nThe software you want is called \u003Cstrong\u003ENeo4j Desktop\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;new_neo4j_download.png&quot; caption=&quot;Neo4j Desktop download&quot; %}\u003C\u002Fp\u003E\\n\u003Cp\u003ENeo4j has recently changed the way the database is installed.\\nOnce you download the desktop and install it you will be prompted to enter your user name and password.\\nAt this point, you can choose to log in with an existing social media account or create a new login name and password.\u003C\u002Fp\u003E\\n\u003Cdiv class=\\\"alert alert-warning\\\"\u003E\\nYou may be prompted to update the software. Our recommendation is to allow the installation to continue and update the software afterwards.\\n\u003C\u002Fdiv\u003E\\n\\n\u003Cp\u003EOnce you start the Neo4j Desktop installation process, the software will take care of installing all of the software it depends on including the latest Java Runtime Environment it depends on.\\nThis step requires that you have a connection to the Internet.\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;new_neo4j_desktop_install.png&quot; caption=&quot;Neo4j Desktop installation&quot; %}\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"creating-a-new-project\\\"\u003ECreating a new project\u003C\u002Fh2\u003E\\n\u003Cp\u003EWhen the Neo4j Desktop starts for the first time, you will see a list of icons on the far left.\\nThe topmost icon is a small file folder. This is the projects tab.\\nYou can edit projects by simply clicking on a project in the project list.\\nWhen you do so, the contents of the project will be displayed on the far right of the application (the part with the white background).\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;neo4j-projects.png&quot; caption=&quot;Neo4j Desktop - Projects tab&quot; %}\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"adding-a-database-to-the-project\\\"\u003EAdding a database to the project\u003C\u002Fh2\u003E\\n\u003Cp\u003EAdding a new database to a project is simply a matter of clicking &quot;New Database&quot;.\\nChoose the &quot;Local&quot; option because we will store an example database to your local machine.\\nYou will then have the option to change the name of your database, the Neo4j version that runs the database, and add a description.\\nWe will simply stay with the defaults, but you can change these options later.\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;new_neo4j_add_db.png&quot; caption=&quot;Neo4j Desktop - Adding a new database to a project.&quot; %}\u003C\u002Fp\u003E\\n\u003Cp\u003EAfter the database is created you will see two buttons underneath.\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;new-neo4j-db-options.png&quot; caption=&quot;Manage options of your database&quot; %}\u003C\u002Fp\u003E\\n\u003Cp\u003EClick on &quot;Manage&quot; and you will be presented with a series of options to customize your database.\\nNow that we have the Neo4j database installed, we need to add some example data so we can use it.\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"loading-data-into-neo4j\\\"\u003ELoading Data into Neo4j\u003C\u002Fh2\u003E\\n\u003Cp\u003EThe easiest way to load data into the Neo4j database is to load the information you are interested in using comma separated value (CSV) files.\\nYou will need to separate your data into data for nodes and data for edges.\\nThis is a common way for network information to be separated.\\nIn this lesson we will use some example data that has already been formatted.\u003C\u002Fp\u003E\\n\u003Cp\u003EUsing the CSV batch loading mechanism in Neo4j is the fastest way to import data into your new database.\\nIn this section I am going to talk about the process more generally for simple cases.\\nThis process assumes that you have an empty database.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003EIf you want to follow along, you can download the example data files\\n\u003Ca href=\\\"\u002Fassets\u002Fdealing-with-big-data-and-network-analysis-using-neo4j\u002Fnodes_companies.csv\\\"\u003Enodes_companies.csv\u003C\u002Fa\u003E and\\n\u003Ca href=\\\"\u002Fassets\u002Fdealing-with-big-data-and-network-analysis-using-neo4j\u002Fedges_director_duration.csv\\\"\u003Eedges_director_duration.csv\u003C\u002Fa\u003E.\\nThe canonical guide to loading data from CSV is on \u003Ca href=\\\"https:\u002F\u002Fneo4j.com\u002Fdeveloper\u002Fguide-import-csv\u002F\\\"\u003Ethe Neo4j website\u003C\u002Fa\u003E.\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003ENow that we have the example CSV files downloaded, we will use the \u003Cstrong\u003ECypher\u003C\u002Fstrong\u003E query language to load them into our empty Neo4j database.\\nCypher is a specialized query language that is designed to load and manipulate data in the Neo4j database.\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"formatting-csv-files-for-loading-into-neo4j\\\"\u003EFormatting CSV files for loading into Neo4j\u003C\u002Fh2\u003E\\n\u003Cp\u003EThe columns in each CSV will have to be properly named to tell the import tools how to properly create relationships.\u003C\u002Fp\u003E\\n\u003Cp\u003ELet&#39;s examine the basic format of the two CSV files we downloaded.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003Enodes_nodes_companies.csv\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\\n\u003Ctable\u003E\\n\u003Cthead\u003E\\n\u003Ctr\u003E\\n\u003Cth\u003EcompanyId\u003C\u002Fth\u003E\\n\u003Cth\u003Ename\u003C\u002Fth\u003E\\n\u003C\u002Ftr\u003E\\n\u003C\u002Fthead\u003E\\n\u003Ctbody\u003E\u003Ctr\u003E\\n\u003Ctd\u003E1\u003C\u002Ftd\u003E\\n\u003Ctd\u003ECANADIAN BANK OF COMMERCE\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\\n\u003Ctd\u003E2\u003C\u002Ftd\u003E\\n\u003Ctd\u003ESHAWINIGAN WATER AND POWER\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\\n\u003Ctd\u003E...\u003C\u002Ftd\u003E\\n\u003Ctd\u003E...\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\\n\u003Cp\u003E\u003Cstrong\u003Eedges_director_duration.csv\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\\n\u003Ctable\u003E\\n\u003Cthead\u003E\\n\u003Ctr\u003E\\n\u003Cth\u003ESTART_ID\u003C\u002Fth\u003E\\n\u003Cth\u003Eyears_served\u003C\u002Fth\u003E\\n\u003Cth\u003EEND_ID\u003C\u002Fth\u003E\\n\u003C\u002Ftr\u003E\\n\u003C\u002Fthead\u003E\\n\u003Ctbody\u003E\u003Ctr\u003E\\n\u003Ctd\u003E1\u003C\u002Ftd\u003E\\n\u003Ctd\u003E2\u003C\u002Ftd\u003E\\n\u003Ctd\u003E2\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\\n\u003Ctd\u003E281\u003C\u002Ftd\u003E\\n\u003Ctd\u003E10\u003C\u002Ftd\u003E\\n\u003Ctd\u003E422\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\\n\u003Ctd\u003E...\u003C\u002Ftd\u003E\\n\u003Ctd\u003E...\u003C\u002Ftd\u003E\\n\u003Ctd\u003E...\u003C\u002Ftd\u003E\\n\u003C\u002Ftr\u003E\\n\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\\n\u003Cp\u003EBy looking at the two data files we can see that the Canadian Bank of Commerce and Shawinigan Water and Power have both employed the same director for 2 years.\\n(The first row of edges_director_duration.csv shows the start node with the Canadian Bank of Commerce ID and the Shawinigan Water and Power ID as the end node.)\\nThis director effectively acts as a tie (also known as a corporate interlock) between the two companies.\u003C\u002Fp\u003E\\n\u003Cp\u003ENote that we could just as easily make the directors the nodes and the companies the edges that connect them.\\nThis would give us a clearer picture of the professional network that unites individual directors.\u003C\u002Fp\u003E\\n\u003Cp\u003EAnother alternative would be to represent both Companies and Directors as node types.\\nDirectors would still act to tie the boards of companies together but there would be a different relationship between the nodes.\u003C\u002Fp\u003E\\n\u003Cdiv class=\\\"alert alert-warning\\\"\u003E\\nDepending on your data and your research questions you will need to decide what is the most sensible way to represent data for your application.\\nTake your time on this phase of your project -- this is a crucial decision that will affect every other aspect of your project going forward.\\n\u003C\u002Fdiv\u003E\\n\\n\u003Cp\u003EWe&#39;ll talk more about defining relationships and nodes below.\u003C\u002Fp\u003E\\n\u003Ch1 id=\\\"using-cypher\\\"\u003EUsing Cypher\u003C\u002Fh1\u003E\\n\u003Cp\u003EIn order to create a network in Neo4j we will load the nodes into the database followed by the information about the edges that connect these nodes together.\\nThe process of loading data from a CSV file into Neo4j is relatively straightforward.\\nWe are going to:\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003EPlace our CSV files so they can be accessed by Neo4j\u003C\u002Fli\u003E\\n\u003Cli\u003EStart the database.\u003C\u002Fli\u003E\\n\u003Cli\u003EOpen the browser and connect to the database so we can run a \u003Cstrong\u003ECypher\u003C\u002Fstrong\u003E command.\u003C\u002Fli\u003E\\n\u003Cli\u003EUsing Cypher, we will load our specially formatted CSV files into the database.\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003EThis process assumes that your data is cleanly separated into node and edge CSV files.\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"moving-the-csv-files-to-the-import-directory\\\"\u003EMoving the CSV files to the import directory\u003C\u002Fh2\u003E\\n\u003Cp\u003EClick on the &quot;Manage&quot; button in the database pane, then the drop down menu next to &quot;Open Folders&quot; and select &quot;Import.&quot; A window will appear with a directory.\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;new-neo4j-files.png&quot; caption=&quot;Pressing the Open Folders button&quot; %}\u003C\u002Fp\u003E\\n\u003Cp\u003EYou now need to copy the\\n\u003Ccode\u003Enodes_nodes_companies.csv\u003C\u002Fcode\u003E and the \u003Ccode\u003Eedges_director_duration.csv\u003C\u002Fcode\u003E files there.\\nNow we can use a Cypher command to load the files.\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;importing.png&quot; caption=&quot;Moving the files to this directory&quot; %}\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"start-the-database\\\"\u003EStart the database\u003C\u002Fh2\u003E\\n\u003Cp\u003EIn order to start the database, press the triangular play icon.\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;new-neo4j-start-db.png&quot; caption=&quot;Pressing the start database button&quot; %}\u003C\u002Fp\u003E\\n\u003Cp\u003EIn the &quot;Details&quot; tab beneath, you will see information about the database starting.\\nYou&#39;ll notice that the database server is running on &quot;HTTP port 7474&quot;.\\nNeo4j allows access to the database through a web server. In the next step, we will open\\na browser to connect to the database.\u003C\u002Fp\u003E\\n\u003Ch2 id=\\\"opening-the-browser\\\"\u003EOpening the browser\u003C\u002Fh2\u003E\\n\u003Cp\u003EClick on the &quot;Open Browser&quot; button. A new browser window will appear.\u003C\u002Fp\u003E\\n\u003Cp\u003EFirst, you will need to login to your new database. By default,\\n the username and password are both \u003Ccode\u003Eneo4j\u003C\u002Fcode\u003E. After you log in the\\n  first time, you will be prompted to create a new password.\u003C\u002Fp\u003E\\n\u003Cp\u003EAt the top of the window is a prompt with a blinking cursor.\\nWe can add our Cypher command to load our data here\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;new-neo4j-browser.png&quot; caption=&quot;Browser window&quot; %}\u003C\u002Fp\u003E\\n\u003Ch3 id=\\\"using-cypher-to-load-the-csv-files-into-the-database\\\"\u003EUsing Cypher to load the CSV files into the database\u003C\u002Fh3\u003E\\n\u003Cp\u003EAgain, press the trianglar run icon &quot;&gt;&quot; in order to execute the command. An example can be seen in the screenshot below:\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;new-neo4j-load1.png&quot; caption=&quot;Cypher command window: loading nodes into the database&quot; %}\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-sql\\\"\u003ELOAD CSV with headers FROM &quot;file:\u002F\u002F\u002Fnodes_companies.csv&quot; as nodes\\nCREATE (n:COMPANY { id:toInteger(nodes.companyId), name:nodes.name })\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe Cypher command LOADs the CSV file that contains informative headers (i.e. the first line)\\nfrom the file we placed in the import directory. (By default, Neo4j can only load files from this directory.)\\nThe results will be stored as an object called \u003Cstrong\u003Enodes\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe second line CREATEs data in our database. In particular, we create a series of node objects of the type COMPANY\\nthat contain a \u003Ccode\u003Ename\u003C\u002Fcode\u003E and an \u003Ccode\u003Eid\u003C\u002Fcode\u003E. We set the name of this new company node to the name stored in the \u003Ccode\u003Enodes.name\u003C\u002Fcode\u003E object and the id to the same as stored in the \u003Ccode\u003Enodes.companyID\u003C\u002Fcode\u003E.\\nNotice that the fields that are stored in the nodes object corresponds to the headers we set in the CSV files.\\nWe also use the \u003Ccode\u003EtoInteger()\u003C\u002Fcode\u003E function to make sure our numbers are represented as integers and not as text.\u003C\u002Fp\u003E\\n\u003Cp\u003ENext we need to load the edge data.\u003C\u002Fp\u003E\\n\u003Cp\u003EThis command does something similar. However, a new command called MATCH has been introduced.\\nThe first line loads the CSV file from the import directory and assigns it to a variable called \u003Cstrong\u003Eedges\u003C\u002Fstrong\u003E.\\nThe next two lines use MATCH. The first line goes to the existing database and finds a COMPANY node with\\nan id the same as START_ID. The next line does the same thing, except looks for a match with the END_ID column\\nin the CSV file. These results are assigned to the variables \u003Ccode\u003Ea\u003C\u002Fcode\u003E and \u003Ccode\u003Eb\u003C\u002Fcode\u003E, respectively.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe final line CREATES a relationship between these nodes. In this case, the relationship type is called INTERLOCK.\\nThere is a field called years within the INTERLOCK that is set to the years_served value from the CSV.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-sql\\\"\u003ELOAD CSV WITH HEADERS FROM &quot;file:\u002F\u002F\u002Fedges_director_duration.csv&quot; AS edges\\nMATCH (a:COMPANY { id: toInteger(edges.START_ID) })\\nMATCH (b:COMPANY { id: toInteger(edges.END_ID)   })\\nCREATE (a)-[r:INTERLOCK{weight:toInteger(edges.years_served)}]-&gt;(b);\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003E\u003Cstrong\u003ENote: If you have difficulties during the loading process, you can delete all of the nodes and\\nedges in your database using the following command.\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode\u003EMATCH (n)\\nDETACH DELETE n\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch3 id=\\\"using-the-cypher-query-language\\\"\u003EUsing the Cypher query language\u003C\u002Fh3\u003E\\n\u003Cp\u003ECypher is a powerful language to query graph databases.\\nCypher is a language dedicated to loading, selecting or altering data that is stored in the Neo4j database.\\nThe following sections will show examples of these actions.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe key to effectively querying Neo4j is to understand that information in the database is represented as a graph and not a table.\\nTherefore, you need to consider the information you&#39;re working with in terms of \u003Cstrong\u003Enodes\u003C\u002Fstrong\u003E and \u003Cstrong\u003Erelationships\u003C\u002Fstrong\u003E that connect nodes together.\u003C\u002Fp\u003E\\n\u003Cp\u003EA typical Cypher statement shows the relationship between two nodes.\u003C\u002Fp\u003E\\n\u003Cp\u003EFor example, we can create a new COMPANY node:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode\u003ECREATE (acompany:COMPANY { id:900, name:&quot;Economical Mutual Fire Insurance Company of Berlin&quot;})\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EIn this example, \u003Ccode\u003Eacompany\u003C\u002Fcode\u003E is the variable name we have given to the node object we created in the database.\\nWe marked the node object as being a \u003Ccode\u003ECOMPANY\u003C\u002Fcode\u003E type.\\nA COMPANY has an attribute called \u003Ccode\u003Eid\u003C\u002Fcode\u003E which is a unique number assigned to that particular company.\\nIn the examples above, each entry also has a \u003Ccode\u003Ename\u003C\u002Fcode\u003E field.\\nWe can use this unique id to query the database for information about the ties from each firm\u003C\u002Fp\u003E\\n\u003Cp\u003ENow suppose that the database already contains data and we aren&#39;t sure if there is information about a given company.\\nIn this case, we can use the MATCH statement to match a unique node and manipulate it.\u003C\u002Fp\u003E\\n\u003Cp\u003EIn the following example, we MATCH both the companynodes (represented by the variables c and p).\\nThe CREATE statement then uses the match for each company and CREATEs a relationship between the two nodes.\\nIn this case, the relationship is of the type INTERLOCK.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode\u003EMATCH  (c1:COMPANY {companyId:281})\\nMATCH  (c2:COMPANY {companyId:879})\\nCREATE (c1)-[r:INTERLOCK{weight:10}]-&gt;(c2)\\nRETURN c1,c2,r;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003ENote that the relationship (r) here is between the two companies.\\nThe relationship between COMPANIES is defined as an INTERLOCK.\\nBut it is important to note that we can define multiple different kinds of nodes and relationships.\u003C\u002Fp\u003E\\n\u003Cdiv class=\\\"alert alert-warning\\\"\u003E\\nData can be represented many different ways.\\nIt is worth carefully considering what insights you want to get out of your data before you commit to a structure in the database.\\n\u003C\u002Fdiv\u003E\\n\\n\u003Cp\u003EFinally, the RETURN statement returns the variables for us to further manipulate.\\nFor example, we might decide to add another attribute to the company.\\nHere we add a URL attribute to the company object that contains the company&#39;s current web site.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode\u003ESET c.url = &quot;https:\u002F\u002Feconomical.com&quot;;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch3 id=\\\"reviewing-the-data\\\"\u003EReviewing the data\u003C\u002Fh3\u003E\\n\u003Cp\u003EThe data supplied in the \u003Ccode\u003Enodes_companies.csv\u003C\u002Fcode\u003E and \u003Ccode\u003Eedges_director_duration.csv\u003C\u002Fcode\u003E files\\nprovides us with the basic corporate interlock network that existed in Canada in 1912.\u003C\u002Fp\u003E\\n\u003Cp\u003EIf we use the web interface that comes with Neo4j we&#39;ll be able to see what parts of this network looks like by using a simple query.\u003C\u002Fp\u003E\\n\u003Cp\u003EWith the Neo4j database running, we can open up the built in browser to make more Cypher queries.\\n(Or we can put the following URL into  a browser \u003Ca href=\\\"http:\u002F\u002Flocalhost:7474\u002Fbrowser\u002F\\\"\u003Ehttp:\u002F\u002Flocalhost:7474\u002Fbrowser\u002F\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003EAdd the following Cypher query.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-sql\\\"\u003EMATCH (n:COMPANY) RETURN n LIMIT 40;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThis query will request that Neo4j find all nodes that are of the type company and return them.\\nThe LIMIT option limits the results to the first 40 nodes.\u003C\u002Fp\u003E\\n\u003Cp\u003EYou should see a network that looks something like this.\u003C\u002Fp\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;new-neo4j-simple-match.png&quot; caption=&quot;Neo4j results after a simple query&quot; %}\u003C\u002Fp\u003E\\n\u003Ch3 id=\\\"a-brief-note-on-index\\\"\u003EA brief note on INDEX\u003C\u002Fh3\u003E\\n\u003Cp\u003ECreating an index is important for any database to run efficiently.\\nAn index is a particular field in a database that is designated for the database to optimize so that lookups are as fast as possible.\u003C\u002Fp\u003E\\n\u003Cp\u003ETo create an index in Neo4j, we would issue the following Cypher command.\\nCreating an index only needs to be done once.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode\u003ECREATE INDEX ON :COMPANY(id)\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003ECreate another index using the company name as well.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode\u003ECREATE INDEX ON :COMPANY(name)\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003ECreating this index will greatly speed up any queries we make based on the unique keys \u003Ccode\u003Eid\u003C\u002Fcode\u003E and \u003Ccode\u003Ename\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\\n\u003Cdiv class=\\\"alert alert-warning\\\"\u003E\\nDon't create more indexes than you need.\\nCreating too many indexes will have the effect of slowing down your database.\\nAgain, designing your database so that you have a unique key to do lookups is crucial.\\n\u003C\u002Fdiv\u003E\\n\\n\u003Ch3 id=\\\"querying-neo4j-create-match-set\\\"\u003EQuerying Neo4j: CREATE, MATCH, SET\u003C\u002Fh3\u003E\\n\u003Cp\u003ESo far we have used the basic syntax of the Cypher query language.\\nWe&#39;ve seen that relationships on a graph are written quite intuitively using Cypher.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode\u003E(n1:NODE)-[:relationship]-&gt;(n2:NODE)\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EIn this section we used Cypher to CREATE entries in the database, MATCH existing data, and we used SET to alter existing data we found.\u003C\u002Fp\u003E\\n\u003Cp\u003EMore on the \u003Ca href=\\\"https:\u002F\u002Fneo4j.com\u002Fdeveloper\u002Fcypher-query-language\u002F\\\"\u003ECypher query language\u003C\u002Fa\u003E can be found on the Neo4j\\nweb site.\u003C\u002Fp\u003E\\n\u003Ch1 id=\\\"putting-it-all-together-a-working-example\\\"\u003EPutting it all together: A working example\u003C\u002Fh1\u003E\\n\u003Cp\u003EIf we return to the \u003Ca href=\\\"http:\u002F\u002Flocalhost:7474\\\"\u003Eweb interface on your local machine\u003C\u002Fa\u003E we can query our new database.\\nLet&#39;s look at the firms that have the greatest number of connections (i.e. the highest degree).\\nTo calculate degree we can make a simple query with Cypher.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode\u003EMATCH (c:COMPANY)\\nset c.degree = size((c)--&gt;());\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThis code simply matches to each node and counts the size (or degree) of each node.\\nWe use the SET command to set the degree value as an attribute of each node.\u003C\u002Fp\u003E\\n\u003Cp\u003ENow we can examine those nodes with the highest degree.\\nHere we list companies where there are 75 or more connections (via high level employees or directors to other companies).\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode\u003Ematch (c0:COMPANY)-[r]-(c1) where c0.degree &gt; 75\\nreturn DISTINCT c0.name;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThis results in the following companies:\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003ETORONTO AND YORK RADIAL RAILWAY\u003C\u002Fli\u003E\\n\u003Cli\u003EMONTREAL ELECTRIC HEAT AND POWER\u003C\u002Fli\u003E\\n\u003Cli\u003ECANADIAN PACIFIC RAILWAY\u003C\u002Fli\u003E\\n\u003Cli\u003ETORONTO RAILWAY\u003C\u002Fli\u003E\\n\u003Cli\u003EDOMINION COAL\u003C\u002Fli\u003E\\n\u003Cli\u003ECANADIAN GENERAL ELECTRIC\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003EWe can also try to examine all of the interlocks between these well-connected companies.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode\u003Ematch (c0:COMPANY)-[r]-(c1) where c0.degree &gt; 75 and c1.degree &gt; 75\\nreturn c0, r, c1;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003E{% include figure.html filename=&quot;graph_example.png&quot; caption=&quot;Example graph&quot; %}\u003C\u002Fp\u003E\\n\u003Cp\u003EYou can download the data used in this lesson \u003Ca href=\\\"http:\u002F\u002Fjgmackay.com\u002F\\\"\u003Ehere\u003C\u002Fa\u003E (search for the relevant blog posts).\\nIf you make use of this data, please cite the following in addition to this lesson:\u003C\u002Fp\u003E\\n\u003Cp\u003EMackay, Jon. 2017. &quot;Canadian Regional and National Business Elites in 1912: Who Was Connected, Who Wasn&#39;t and\\nWhy&quot; In A History of Socially Responsible Business, c.1600--1950, 189-212. Palgrave Studies in the History\\nof Finance. Palgrave Macmillan.\\n\u003Ca href=\\\"https:\u002F\u002Fdoi.org\u002F10.1007\u002F978-3-319-60146-5_8\\\"\u003Ehttps:\u002F\u002Fdoi.org\u002F10.1007\u002F978-3-319-60146-5_8\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Ch1 id=\\\"conclusion\\\"\u003EConclusion\u003C\u002Fh1\u003E\\n\u003Cp\u003EIn this lesson we&#39;ve introduced the Neo4j graph database.\\nWe&#39;ve shown how we can talk directly to the database using the Cypher query language.\\nWe&#39;ve also shown how easy it is to visualize different parts of graphs stored in Neo4j using\\nNeo4j&#39;s built in visualization system.\\nFinally, we&#39;ve also included some data and example code that reinforces the key topics of this lesson.\\nWherever possible this lesson has also linked to primary documents and software to make getting started as easy as possible.\u003C\u002Fp\u003E\\n\"}"}</script></div>
	</body>
</html>
